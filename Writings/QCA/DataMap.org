#+OPTIONS: num:nil
#+TITLE: QCA Data Map
#+AUTHOR: Gabriel Petrini
#+startup: fold
#+PROPERTY:header-args python :results output drawer :eval never-export :session map :exports both
#+PROPERTY:header-args R:results output drawer :eval never-export :session map :exports both
* Properties :noexport:
#+TODO: Searching Filed | Downloaded Scripted Cleaned | NotFound
#+PROPERTY: COLUMNS  %TODO %ITEM %VAR_TYPE(Var.) %FREQUENCY(FRQ)  %START(Start) %END(End) %COVERAGE(Cov) %SEASONAL_ADJ(Season. Adj) %KEY(Key) %URL
#+PROPERTY: FREQUENCY_ALL Yearly Quarterly Monthly Weekly Daily
#+PROPERTY: START_ALL
#+PROPERTY: END_ALL
#+PROPERTY: DESCRIPTION_ALL
#+PROPERTY: KEY_ALL
#+PROPERTY: COVERAGE_ALL "Block and Domestic Currency" Country Region Province State City ZipCode
#+PROPERTY: PUBLIC_ALL Yes No
#+PROPERTY: SEASONAL_ADJ_ALL Yes No "Not Informed"
#+PROPERTY: VAR_TYPE_ALL "YoY pct" "pct change" "ratio" "nominal" "real" "index" "Dummy"


* HTML headers                                         :noexport:ignore:
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>

#+HTML_HEAD: <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
#+HTML_HEAD: <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
#+HTML_HEAD: <script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>

* Usefull links

- [[https://www.fhfa.gov/DataTools/Downloads/Documents/FHLBank-PUDB/AMA_PUDB_definitions_2019.pdf][FHLBank Public Use Database (USA)]]
- [[https://sdw.ecb.europa.eu/browse.do?node=9689356][Residential Real Estate variables (EuroStat)]]
- [[https://www.eba.europa.eu/sites/default/documents/files/documents/10180/526027/a63306a6-3010-426d-b35f-f18aad9bb25d/Loan%20to%20value%20definitions.pdf?retry=1][Loan to value definitions by banks]]
- [[https://www.cmhc-schl.gc.ca/en/data-and-research/data-tables/mortgage-consumer-credit-trends-cmas][Canada's mortgage related dataset]]
- [[https://www.ecb.europa.eu/pub/economic-research/research-networks/html/researcher_hfcn.en.html][Household Finance and Consumption Network (HFCN):]] For some microdata about houseld expectations for housing
- [[https://www.bis.org/statistics/pp/disclaimer.htm][Sources of property price data sets]]
- [[https://www.bis.org/statistics/full_data_sets.htm][Download BIS statistics in a single file]]
- [[https://hypo.org/ecbc/publications/hypostat/][Hypostat]]
* Data Sources Summary

#+BEGIN: columnview :maxlevel 3 :id global
| TODO      | ITEM                                                           | Var.    | FRQ       |   Start |     End | Cov                         | Season. Adj  | Key                        | URL  |
|-----------+----------------------------------------------------------------+---------+-----------+---------+---------+-----------------------------+--------------+----------------------------+------|
|           | HTML headers                                                   |         |           |         |         |                             |              |                            |      |
|           | Usefull links                                                  |         |           |         |         |                             |              |                            |      |
|           | Data Sources Summary                                           |         |           |         |         |                             |              |                            |      |
|           | Mortgaging - cite:jorda_2016_great                             |         |           |         |         |                             |              |                            |      |
|           | Mortgage Loan to Value Ratio                                   |         |           |         |         |                             |              |                            |      |
| Filed     | England                                                        | ratio   | Quarterly |  1974Q1 |  2018Q3 | Country                     | Not Informed |                            | [[http://opendatacommunities.org/data/housing-market/ratio/loan-to-value][Link]] |
| Filed     | USA                                                            | ratio   | Monthly   | 2017M01 | 2020M03 | Country                     | Not Informed |                            | [[https://www.fhfa.gov/DataTools/Downloads/Documents/NATIONAL-MORTGAGE-DATABASE-(NMDB)-AGGREGATE-DATA/National-Statistics-for-New-Residential-Mortgages-in-the-United-States.xlsx][Link]] |
|           | Share of variable rate loans in total loans for house purchase |         |           |         |         |                             |              |                            |      |
| Searching | Canada                                                         | ratio   | Yearly    |    2006 |    2017 | Country                     | Not Informed |                            | [[https://www.canadianmortgagetrends.com/wp-content/uploads/2014/11/Res_Mtge_Mkt_Fall-Report-Final.pdf][Link]] |
|           | [[https://www.canadianmortgagetrends.com/wp-content/uploads/2014/11/Res_Mtge_Mkt_Fall-Report-Final.pdf][2014]]                                                           |         |           |         |         |                             |              |                            |      |
| Searching | Japan                                                          |         |           |         |         |                             |              |                            |      |
| Searching | Norway                                                         |         |           |         |         |                             |              |                            |      |
| Searching | Switzerland                                                    |         |           |         |         |                             |              |                            |      |
| Filed     | USA - Fixed                                                    | nominal | Monthly   |    1986 |    2018 | Country                     | Not Informed |                            | [[https://www.fhfa.gov/DataTools/Downloads/Documents/Historical-Summary-Tables/Table20-2019-by-Month.xls][Link]] |
| Filed     | USA - Adjustable                                               | nominal | Monthly   |    1986 |    2018 | Country                     | Not Informed |                            | [[https://www.fhfa.gov/DataTools/Downloads/Documents/Historical-Summary-Tables/Table23-2019-by-Month.xls][Link]] |
| Filed     | Austria                                                        | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.AT.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.AT.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Belgium                                                        | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.BE.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.BE.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Bulgaria                                                       | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.BG.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.BG.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Cyprus                                                         | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.CY.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.CY.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Czech Republic (CZ)                                            | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.CZ.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.CZ.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Germany (DE)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.DE.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.DE.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Denmark (DK)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.DK.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.DK.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Estonia (EE)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.DK.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.EE.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Estonia (EE)                                                   | ratio   | Monthly   |    2003 |    2020 | Block and Domestic Currency | Not Informed | RAI.M.EE.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.EE.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Spain (ES)                                                     | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.ES.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.ES.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Finland (FI)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.FI.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.ES.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | France (FR)                                                    | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.FR.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.FR.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | United Kingdom (GB)                                            | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.GB.SVLHPHH.GBP.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.GB.SVLHPHH.GBP.MIR.Z][Link]] |
| Filed     | Greece (GR)                                                    | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.GR.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.GR.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Croatia (HR)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.HR.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.HR.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Hungary (HU)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.HU.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.HU.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Ireland (IE)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.IE.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.IE.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Italy (IT)                                                     | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.IT.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.IT.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Luxembourg (LU)                                                | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.LU.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.LU.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Netherlands (NL)                                               | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.NL.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.NL.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Poland (PL)                                                    | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.PL.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.PL.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Portugal (PT)                                                  | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.PT.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.PT.SVLHPHH.EUR.MIR.Z][Link]] |
| Filed     | Romania (RO)                                                   | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.SE.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.RO.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Sweden (SE)                                                    | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.SE.SVLHPHH.U1.MIR.Z  | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.SE.SVLHPHH.U1.MIR.Z][Link]] |
| Filed     | Euro area                                                      | ratio   | Monthly   |    2003 |    2020 | Country                     | Not Informed | RAI.M.U2.SVLHPHH.EUR.MIR.Z | [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.U2.SVLHPHH.EUR.MIR.Z][Link]] |
|           | Loan Purpose Type                                              |         |           |         |         |                             |              |                            |      |
|           | Property Usage Type                                            |         |           |         |         |                             |              |                            |      |
|           | Borrower Credit Score Value                                    |         |           |         |         |                             |              |                            |      |
|           | Homeownership Rate                                             |         |           |         |         |                             |              |                            |      |
|           | Mortgage Debt Outstanding-to-GDP                               |         |           |         |         |                             |              |                            |      |
|           | Early Repayment                                                |         |           |         |         |                             |              |                            |      |
|           | Amortzation and Term                                           |         |           |         |         |                             |              |                            |      |
|           | Mortgage Default and Foreclosure                               |         |           |         |         |                             |              |                            |      |
|           | Mortgage Funding                                               |         |           |         |         |                             |              |                            |      |
|           | Mortgage depth                                                 |         |           |         |         |                             |              |                            |      |
|           | Housing Loan Penetration                                       |         |           |         |         |                             |              |                            |      |
#+END

* Code initialization
** Python
#+begin_src python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from tabulate import tabulate

print("numpy version  : ", np.__version__)
print("pandas version : ", pd.__version__)
print("seaborn version : ", sns.__version__)

plt.style.use('seaborn-white')
#+end_src

#+RESULTS:
:results:
numpy version  :  1.18.4
pandas version :  1.1.3
seaborn version :  0.11.0
:end:
** R

#+begin_src R
library(tidyverse, warn.conflicts = FALSE) # dplyr, ggplot2, etc
library(gghighlight) # for some data in second plane
library(haven) # For loading stata datasets

options(warn = -1)
#+end_src

#+RESULTS:
:results:
:end:

* Mortgaging - cite:jorda_2016_great
:PROPERTIES:
:URL:     [[http://www.macrohistory.net/data/][Link]] 
:FREQUENCY: Yearly
:START:    1970 
:END:      2016
:DESCRIPTION: "The database covers 17 advanced economies since 1870 on an annual basis. It comprises 45 real and nominal variables. Among these, there are time series that had been hitherto unavailable to researchers, among them financial variables such as bank credit to the non-financial private sector, mortgage lending and long-term returns on housing, equities, bonds and bills. The database captures the near-universe of advanced-country macroeconomic and asset price dynamics, covering on average over 90 percent of advanced-economy output and over 50 percent of world output."
:COVERAGE: Block and Domestic Currency
:PUBLIC:   Yes
:SEASONAL_ADJ: No
:VAR_TYPE: real
:END:
** Countries List

- Australia
- Belgium
- Canada
- Denmark
- Finland
- France
- Germany
- Italy
- Japan
- Netherlands
- Norway
- Portugal
- Spain
- Sweden
- Switzerland
- United Kingdom
- United States
  
** Variables Overview
|--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Variables                      | Description                                                                                                                                                                                                                                                                 |
| <30>                           | <30>                                                                                                                                                                                                                                                                        |
|--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Real Economy                   | Nominal GDP (local currency), Real GDP per capita (PPP), Real GDP per capita (index, 2005=100), Real Consumption per capita (index, 2006=100), Investment-to-GDP Ratio, Population                                                                                          |
| International                  | Current Account (nominal, local currency), Imports (nominal, local currency), Exports (nominal, local currency), USD Exchange Rate (local currency/USD)                                                                                                                     |
| Government                     | Government Revenue (nominal, local currency), Government Expenditure (nominal, local currency), Public Debt-to-GDP Ratio                                                                                                                                                    |
| Money, Prices & Interest Rates | Narrow Money (nominal, local currency), Broad Money (nominal, local currency), Short-term Interest Rate (nominal, percent per year), Long-term Interest Rates (nominal, percent per year), Consumer Prices (index, 1990=100)                                                |
| Credit Data                    | Total Loans to Non-financial Private Sector (nominal, local currency), Mortgage Loans to Non-financial Private Sector (nominal, local currency), Total Loans to Households (nominal, local currency), Total Loans to Business (nominal, local currency)                     |
| House Prices                   | House Prices (index, 1990=100)                                                                                                                                                                                                                                              |
| Crisis Dates                   | Systemic Financial Crisis (0-1 dummy)                                                                                                                                                                                                                                       |
| Rates of Return                | Equity Total Return, Capital Gain and Dividend Yield; Housing Total Return, Capital Gain and Rental Yield; Government Bond Total Return, Government Bill Rate; Total Rates of Return on Risky and Safe Assets, and on Overall Wealth. All data are nominal, local currency. |
| Peg Data                       | Peg (0-1 dummy), Strict Peg (0-1 dummy), Peg Type (Base, Peg, Float), Peg Base                                                                                                                                                                                              |
|--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

** Quick inspection
#+begin_src python :results pp
df = pd.read_excel(
    io="http://www.macrohistory.net/JST/JSTdatasetR4.xlsx",
    sheet_name="Data",
    index_col=[2, 0],
    parse_dates=True,
)
df = df.drop(["country", "ifs", "peg_type", "peg_base"], axis="columns")
print(df.describe())
#+end_src

#+RESULTS:
#+begin_example
                 pop       rgdpmad       rgdppc       rconpc           gdp  ...    bond_rate   eq_div_rtn   capital_tr     risky_tr      safe_tr
count    2499.000000   2499.000000  2499.000000  2411.000000  2.474000e+03  ...  2301.000000  2083.000000  1763.000000  1786.000000  2168.000000
mean    31955.383336   8682.644589    37.832058    40.043222  2.177163e+06  ...     0.055887     0.043225     0.100468     0.112592     0.052806
std     45230.239000   7551.731010    32.145419    30.860849  1.468816e+07  ...     0.030687     0.017700     0.091458     0.111806     0.048646
min      1675.000000    737.375497     3.263085     4.074400  1.250757e-11  ...    -0.000400     0.000000    -0.232140    -0.238515    -0.152371
25%      5107.933000   2771.511473    12.509331    15.235000  3.262150e+01  ...     0.036950     0.032460     0.049847     0.051196     0.026311
50%     10605.870000   5193.394590    22.125076    26.560000  1.613274e+03  ...     0.046900     0.043091     0.091775     0.103964     0.043828
75%     45613.500000  14024.706784    61.578296    64.933650  4.150800e+04  ...     0.064158     0.053744     0.139122     0.162037     0.069026
max    322783.332739  36359.374592   117.645175   115.435926  1.861064e+08  ...     0.237154     0.138189     1.144161     1.281639     0.408514

[8 rows x 45 columns]
#+end_example

** Comparing mortgaging pre-2007 and post-2008

#+begin_src python :results graphics file :file ./figs/Jorda_TQCA_Outcome.png
tmp = (
    df.reset_index(level=[0, 1])
    .loc[:, ["iso", "year", "tmort", "tloans"]]
    .copy(deep=True)
)
tmp.set_index(["year"], inplace=True)
tmp["Mortgaging"] = tmp["tmort"] / tmp["tloans"]
tmp = tmp.pivot(columns="iso", values="Mortgaging")
tmp = tmp.loc["2009-01-01", :] - tmp.loc["2006-01-01", :]
tmp.index.name = "Country"
tmp = tmp.sort_values(ascending=False)
tmp.to_csv("./raw/Jorda_TQCA_Outcome_2009_2007.csv", header=["DMRTG"])
fig, ax = plt.subplots(figsize=(8, 5))
tmp.plot(kind="bar", edgecolor="black", lw=2, ax=ax)
sns.despine()

ax.set_title("$\Delta$ Mortgaging (2009 - 2006)")

fig.savefig("./figs/Jorda_TQCA_Outcome.png", dpi=300, bbox_inches="tight")

plt.close()
#+end_src

#+RESULTS:
[[file:./figs/Jorda_TQCA_Outcome.png]]

** Facet plot

#+begin_src R :results graphics file :file ./figs/Jorda_Facet.png
df = read_dta(
  'http://www.macrohistory.net/JST/JSTdatasetR4.dta',
  encoding = NULL,
  col_select = NULL,
  skip = 0,
  n_max = Inf,
  .name_repair = "unique"
) %>% mutate(mortgaging = tmort/tloans) %>%
  mutate(year = lubridate::ymd(year, truncated = 2L)) %>%
  select(year, country, mortgaging) %>%
  pivot_wider(names_from = country, values_from = mortgaging) %>%
  rowwise() %>% mutate("[Average]" = mean(c_across(Australia:USA), na.rm=TRUE)) %>%
  pivot_longer(!year, names_to = "country", values_to = "mortgaging")

ggplot(df) +
  geom_line(aes(year, mortgaging, colour = country), color='black') +
  gghighlight(use_direct_label = FALSE) +
  facet_wrap(~ country) +
  xlab("") + ylab("Mortgage share on total loans") +
  geom_hline(yintercept=.50, linetype="dashed", color = "black", size=0.25) +
  scale_x_date(date_breaks = "25 years", date_minor_breaks = "5 years", date_labels = "%Y")

ggsave(
  './figs/Jorda_Facet.png',
  width = 10, height = 8, dpi = 150, units = "in", device='png'
       )
#+end_src

#+RESULTS:
[[file:./figs/Jorda_Facet.png]]




** Real estate share of bank lending

#+begin_src R :results graphics file :file ./figs/Jorda_BarSorted.png
df = read_dta(
  'http://www.macrohistory.net/JST/JSTdatasetR4.dta',
  encoding = NULL,
  col_select = NULL,
  skip = 0,
  n_max = Inf,
  .name_repair = "unique"
) %>% filter(year == 1970 | year == 1989 | year == 2007 | year == max(year)) %>%
  mutate(mortgaging = tmort/tloans) %>%
  ## mutate(year = lubridate::ymd(year, truncated = 2L)) %>%
  select(year, country, mortgaging) %>%
  pivot_wider(names_from = country, values_from = mortgaging) %>%
  rowwise() %>% mutate("[Average]" = mean(c_across(Australia:USA), na.rm=TRUE)) %>%
  pivot_longer(!year, names_to = "country", values_to = "mortgaging") %>%
  group_by(year) %>%
  arrange(desc(mortgaging), .by_group = TRUE)

ggplot(df, aes(tidytext::reorder_within(country, mortgaging, year), mortgaging, fill=1-mortgaging)) +
    geom_bar(show.legend = FALSE,stat='identity', color='black') +
    facet_wrap(~year, scales = "free_y") +
    coord_flip() +
    scale_y_continuous(expand = c(0,0)) +
    tidytext::scale_x_reordered() +
    xlab("") + ylab("Mortgage share on total loans") +
    geom_text(aes(label=round(mortgaging,2)), position = position_stack(vjust= 0.5),
            colour = "white", size = 2.5)

ggsave(
  './figs/Jorda_BarSorted.png',
  width = 10, height = 8, dpi = 150, units = "in", device='png'
       )
#+end_src

#+RESULTS:
[[file:./figs/Jorda_BarSorted.png]]



* Mortgage Loan to Value Ratio
[[https://sdw.ecb.europa.eu/browse.do?node=9689356][ECB Statistical Data Warehouse:]] In the future, these should hopefully be complemented with comprehensive and comparable data on mortgage loan maturities and LTV, DSTI or LTI ratios.
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** Filed United Kingdom
:PROPERTIES:
:URL:      [[http://opendatacommunities.org/data/housing-market/ratio/loan-to-value][Link]]
:FREQUENCY: Quarterly
:START:    1974Q1
:END:      2018Q3
:DESCRIPTION: "This dataset contains quarterly median loan to value ratios for first time buyers in England."
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:END:

** Filed United States
:PROPERTIES:
:URL: [[https://www.fhfa.gov/DataTools/Downloads/Documents/NATIONAL-MORTGAGE-DATABASE-(NMDB)-AGGREGATE-DATA/National-Statistics-for-New-Residential-Mortgages-in-the-United-States.xlsx][Link]]
:FREQUENCY: Monthly
:START:    2017M01
:END:      2020M03
:DESCRIPTION: "The National Mortgage Database (NMDB®) is a nationally representative five percent sample of residential mortgages in the United States."
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:END:

This dataset has one year data per spreadcheet. Additionaly, there are other data of interest such as:
- LTV by Ratio Class
- Average Credit Score
  + Share of Mortgages with Credit Score Below 600 (%)
- Average Term Maturity (Years)

*OBS:* Date for *New* Residential Mortgage.

* Share of variable rate loans in total loans for house purchase
** Searching Canada
:PROPERTIES:
:URL: [[https://www.canadianmortgagetrends.com/wp-content/uploads/2014/11/Res_Mtge_Mkt_Fall-Report-Final.pdf][Link]]
:FREQUENCY: Yearly
:START:    2006
:END:      2017
:DESCRIPTION: "Report result"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:END:

*** [[https://www.canadianmortgagetrends.com/wp-content/uploads/2014/11/Res_Mtge_Mkt_Fall-Report-Final.pdf][2014]]

** Searching Japan
** Searching Norway
** Searching Switzerland
** Filed USA - Fixed
:PROPERTIES:
:URL: [[https://www.fhfa.gov/DataTools/Downloads/Documents/Historical-Summary-Tables/Table20-2019-by-Month.xls][Link]]
:FREQUENCY: Monthly
:START:    1986
:END:      2018
:DESCRIPTION: "The National Mortgage Database (NMDB®) is a nationally representative five percent sample of residential mortgages in the United States."
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: nominal
:END:

** Filed USA - Adjustable
:PROPERTIES:
:URL: [[https://www.fhfa.gov/DataTools/Downloads/Documents/Historical-Summary-Tables/Table23-2019-by-Month.xls][Link]]
:FREQUENCY: Monthly
:START:    1986
:END:      2018
:DESCRIPTION: "The National Mortgage Database (NMDB®) is a nationally representative five percent sample of residential mortgages in the United States."
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: nominal
:END:

** Filed Austria
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.AT.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.AT.SVLHPHH.EUR.MIR.Z
:END:

** Filed Belgium
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.BE.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:   RAI.M.BE.SVLHPHH.EUR.MIR.Z
:END:

** Filed Bulgaria
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.BG.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:    RAI.M.BG.SVLHPHH.U1.MIR.Z
:END:

** Filed Cyprus
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.CY.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.CY.SVLHPHH.EUR.MIR.Z
:END:

** Filed Czech Republic (CZ)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.CZ.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.CZ.SVLHPHH.U1.MIR.Z
:END:

** Filed Germany (DE)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.DE.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:   RAI.M.DE.SVLHPHH.EUR.MIR.Z
:END:

** Filed Denmark (DK)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.DK.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.DK.SVLHPHH.U1.MIR.Z
:END:

** Filed Estonia (EE)
:PROPERTIES:
:URL:  [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.EE.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.DK.SVLHPHH.U1.MIR.Z
:END:

** Filed Estonia (EE)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.EE.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Block and Domestic Currency
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.EE.SVLHPHH.U1.MIR.Z
:END:

** Filed Spain (ES)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.ES.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.ES.SVLHPHH.EUR.MIR.Z
:END:

** Filed Finland (FI)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.ES.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.FI.SVLHPHH.EUR.MIR.Z
:END:

** Filed France (FR)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.FR.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.FR.SVLHPHH.EUR.MIR.Z
:END:

** Filed United Kingdom (GB)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.GB.SVLHPHH.GBP.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.GB.SVLHPHH.GBP.MIR.Z
:END:

** Filed Greece (GR)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.GR.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.GR.SVLHPHH.EUR.MIR.Z
:END:

** Filed Croatia (HR)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.HR.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.HR.SVLHPHH.U1.MIR.Z
:END:

** Filed Hungary (HU)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.HU.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.HU.SVLHPHH.U1.MIR.Z
:END:

** Filed Ireland (IE)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.IE.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY: RAI.M.IE.SVLHPHH.EUR.MIR.Z
:END:

** Filed Italy (IT)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.IT.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.IT.SVLHPHH.EUR.MIR.Z
:END:

** Filed Luxembourg (LU)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.LU.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.LU.SVLHPHH.EUR.MIR.Z
:END:

** Filed Netherlands (NL)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.NL.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.NL.SVLHPHH.EUR.MIR.Z
:END:

** Filed Poland (PL)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.PL.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.PL.SVLHPHH.U1.MIR.Z
:END:

** Filed Portugal (PT)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.PT.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY: RAI.M.PT.SVLHPHH.EUR.MIR.Z
:END:

** Filed Romania (RO)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.RO.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.SE.SVLHPHH.U1.MIR.Z
:END:

** Filed Sweden (SE)
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.SE.SVLHPHH.U1.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.SE.SVLHPHH.U1.MIR.Z
:END:

** Filed Euro area
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/quickview.do?SERIES_KEY=304.RAI.M.U2.SVLHPHH.EUR.MIR.Z][Link]]
:FREQUENCY: Monthly
:START:    2003
:END:      2020
:DESCRIPTION: "Share of variable rate loans in total loans for house purchase"
:COVERAGE: Country
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY:  RAI.M.U2.SVLHPHH.EUR.MIR.Z
:END:


* Loan Purpose Type
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Property Usage Type
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Borrower Credit Score Value
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Homeownership Rate
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Mortgage Debt Outstanding-to-GDP
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Early Repayment
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Amortzation and Term
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Mortgage Default and Foreclosure
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Mortgage Funding
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Mortgage depth
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Housing Loan Penetration
** Australia
** Belgium
** Canada
** Denmark
** Finland
** France
** Germany
** Italy
** Japan
** Netherlands
** Norway
** Portugal
** Spain
** Sweden
** Switzerland
** United Kingdom
** United States

* Changes in credit standard
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/browse.do?node=bbn3663][Link]]
:FREQUENCY: Quarterly
:START:    2007
:END:      2020
:DESCRIPTION: "Changes in credit standards for loans to households (for house purchase)"
:COVERAGE: Block and Domestic Currency
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: index
:KEY:  BLS.Q.DE.ALL.O.E.Z.B3.ST.S.FNET
:END:

Countries list:
- Euro Area
- Germany
- Spain
- Italy
- France

* Loan-to-Deposits ratio
:PROPERTIES:
:URL: [[https://sdw.ecb.europa.eu/browse.do?node=bbn3329][Link]]
:FREQUENCY: Quarterly
:START:    1997
:END:      2020
:DESCRIPTION: ""
:COVERAGE: Block and Domestic Currency
:PUBLIC:   Yes
:SEASONAL_ADJ: Not Informed
:VAR_TYPE: ratio
:KEY: ""
:END:
Countries list:
- Australia
- Belgium
- Denmark
- Finland
- France
- Germany
- Italy
- Netherlands
- Portugal
- Spain
- Sweden
