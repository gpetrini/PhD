#+PROPERTY: header-args:ipython :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
* Empirical TODOs and Setups                                       :noexport:

** Loading packages
   
#+BEGIN_SRC ipython
%config InlineBackend.figure_format = 'retina'

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import pandas_datareader.data as web
import datetime
from datetime import datetime as dt

sns.set_context('paper')
plt.style.use('seaborn-white')

start = datetime.datetime(1951, 12, 1)
end = datetime.datetime(2019, 3, 1)

def salvar_grafico(file_name, extension=".png", pasta="./figs/"):
    fig.savefig(pasta + file_name + extension, dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.2, transparent = False,)
#+END_SRC

#+RESULTS:
:results:
# Out [10]: 
:end:

** Functions

#+BEGIN_SRC ipython :results output :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
def crise_subprime(axes, alpha=0.4):
    axes.axvspan(
    xmin='2007-12-01', 
    xmax='2009-06-01',
    color='gray', 
    label='Subprime Crises',
    zorder=0,
    alpha=alpha
)

def crises(axes, color='lightgray', alpha=0.4, zorder=1):
    axes.axvspan(xmin = "1953-07", xmax='1954-04', color = color, alpha=alpha, label = 'Recession', zorder=zorder)
    axes.axvspan(xmin = "1957-08", xmax='1958-05', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1960-05", xmax='1961-02', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1969-12", xmax='1970-11', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1973-11", xmax='1975-03', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1980-01", xmax='1980-07', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1981-07", xmax='1982-01', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "1990-07", xmax='1991-03', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "2001-03", xmax='2001-11', color = color, alpha=alpha, label = '', zorder=zorder)
    axes.axvspan(xmin = "2007-12", xmax='2009-7', color = color, alpha=alpha, label = '', zorder=zorder)
#+END_SRC

#+RESULTS:
:results:
# Out [21]: 
:end:

** Getting data
   
#+BEGIN_SRC ipython :async t :results output :session empirical :exports results :tangle ./codes/Empirical_Motivation.py
df = web.DataReader(
    [
        'GDP',
        'PRFI',
        'PNFI',
        'TCU',
        'PCDG',
    ], 
    'fred', 
    start, end
)
df['TCU'] = df['TCU']/100
df['H-GFI'] = df['PRFI']/df['PNFI']
df['H-GDP'] = df['PRFI']/df['GDP']
df['Investment share'] = df['PNFI']/df['GDP']
df['Housing share'] = df['PRFI']/df['GDP']
df["Durables"] = df["PCDG"]/df["GDP"]
df['Year'] = df.index.year
df = df.resample('Q').last()
df.index.name = ''
df.to_csv('./data/Cycle.csv')

#+END_SRC

#+RESULTS:
:results:
63 - 86d642db-e11d-4509-aa92-e3935a369992 <output> <interrupt>
:end:


#+BEGIN_SRC ipython :async t :results output :session empirical :exports results :tangle ./codes/Empirical_Motivation.py
start=dt(1987,1,1)
end=dt(2019,10,1)

df = web.DataReader(
    [
        "PRFI",
        "CSUSHPISA",
        "MORTGAGE30US",
        "CPIAUCSL"
    ], 
    'fred', 
    start, 
    end
)

df.columns = [
    "Residential investment", 
    "House prices", 
    "Mortgage interest rate",
    "General Prices"
]
df.index.name = ""


df['Mortgage interest rate'] = df['Mortgage interest rate'].divide(100)
df = df.resample('M').last()

df['House prices'] = df['House prices']/df['House prices'][0]
df = df.resample('Q').last()
df["Inflation"]= df["House prices"].pct_change()
df["General inflation"] = df["General Prices"].pct_change()
df["Own interest rate"] = ((1+df["Mortgage interest rate"])/(1+df["Inflation"])) -1
df["Real mortgage interest rate"] = ((1+df["Mortgage interest rate"])/(1+df["General inflation"])) -1

df['$g_{I_h}$'] = df["Residential investment"].pct_change()
df.to_csv("./data/OwnInterestRate_data.csv")
#+END_SRC

#+RESULTS:
:results:
64 - 82767da6-004c-41d8-94ce-333cf828b280 <output> <interrupt>
:end:

** Residuals

#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

sns.set_context('talk')
fig, ax = plt.subplots(1,2, figsize=(2*8,5),
                       sharex=True, sharey=True
)



sns.scatterplot(y = 'Housing share', x='Own interest rate', data=df["1992-01":"2001-12"],
                ax=ax[0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='Own interest rate', data=df["1992-01":"2001-12"],
             ax=ax[0], sort=False, color = 'black')
ax[0].set_title("1992 (I) - 2001 (IV)")

sns.scatterplot(y = 'Housing share', x='Own interest rate', data=df["2001-12":"2009-07"],
                ax=ax[1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='Own interest rate', data=df["2001-12":"2009-07"],
             ax=ax[1], sort=False, color = 'black')
ax[1].set_title("2001 (IV) - 2009 (II)")


sns.despine()
fig.tight_layout(rect=[0, 0.03, 1, 1])
plt.show()

fig.savefig("./figs/Own_Cycle.png", transparent = True, dpi = 300)

#+END_SRC

#+RESULTS:
:results:
65 - c96451fb-4ee2-480b-9667-de15002b080d <output> <interrupt>
:end:



#+BEGIN_SRC latex
\begin{figure}[htb]
    \centering
        \caption{Share of residential investment and Houses own interest rate\\\centering Before and after housing bubble\\\centering (Dots size grow in  time)} 
    \includegraphics[width = 0.65\textwidth]{./figs/Own_Cycle.png}
    \label{fig:cycles}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration.}
\end{figure}
#+END_SRC

#+RESULTS:
#+begin_export latex
\begin{figure}[htb]
    \centering
        \caption{Share of residential investment and Houses own interest rate\\\centering Before and after housing bubble\\\centering (Dots size grow in  time)} 
    \includegraphics[width = 0.65\textwidth]{./figs/Own_Cycle.png}
    \label{fig:cycles}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration.}
\end{figure}
#+end_export


#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
fig, ax = plt.subplots()

df['H-GDP'].plot(color = 'black', label = 'Residential investment/GDP', ax = ax)
ax.axvspan(xmin = "1953-07", xmax='1954-04', color = "lightgray", label = 'Recession')
ax.axvspan(xmin = "1957-08", xmax='1958-05', color = "lightgray", label = '')
ax.axvspan(xmin = "1960-05", xmax='1961-02', color = "lightgray", label = '')
ax.axvspan(xmin = "1969-12", xmax='1970-11', color = "lightgray", label = '')
ax.axvspan(xmin = "1973-11", xmax='1975-03', color = "lightgray", label = '')
ax.axvspan(xmin = "1980-01", xmax='1980-07', color = "lightgray", label = '')
ax.axvspan(xmin = "1981-07", xmax='1982-01', color = "lightgray", label = '')
ax.axvspan(xmin = "1990-07", xmax='1991-03', color = "lightgray", label = '')
ax.axvspan(xmin = "2001-03", xmax='2001-11', color = "lightgray", label = '')
ax.axvspan(xmin = "2007-12", xmax='2009-07', color = "lightgray", label = '')
ax.legend()
sns.despine()
fig.savefig("./figs/housing_gdp.png", transparent = True, dpi = 300)
plt.show()
#+END_SRC

#+RESULTS:
:results:
66 - d65f11da-12bb-4214-b1dd-d572b125f426 <output> <interrupt>
:end:


#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

sns.set_context('talk')
fig, ax = plt.subplots(1,2, figsize=(2*8,5),
                       sharex=True, sharey=True
)



sns.scatterplot(x = 'Housing share', y='Durables', data=df["1992-01":"2001-12"],
                ax=ax[0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Housing share', y='Durables', data=df["1992-01":"2001-12"],
             ax=ax[0], sort=False, color = 'black')
ax[0].set_title("1992 (I) - 2001 (IV)")

sns.scatterplot(x = 'Housing share', y='Durables', data=df["2001-12":"2009-07"],
                ax=ax[1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Housing share', y='Durables', data=df["2001-12":"2009-07"],
             ax=ax[1], sort=False, color = 'black')
ax[1].set_title("2001 (IV) - 2009 (II)")


sns.despine()
fig.tight_layout(rect=[0, 0.03, 1, 1])
plt.show()

fig.savefig("./figs/Durables.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
67 - d21deaae-6d95-4ac4-8096-83d74e4cff8e <output> <interrupt>
:end:


*** Consumo de bens duráveis

@@comment: Importância da bolha de ativos para explicar o investimento residencial e, por conseguinte, o ciclo econômico comment@@
There is also an indirect relation between residential investment and durables goods consumption. Real estate constitutes a significant portion of household wealth so houses serves as collateral to borrowing cite:teixeira_uma_2011. 
As a consequence of U.S. institutional arrangement, households could increase their indebtedness as house
prices went up (see Figure ref:fig:debt) as a way to ``make'' capital gains without selling their houses during the 2000s housing bubble cite:teixeira_crescimento_2015,hay_failure_2013. 
The relation between households indebtedness and real estate inflation also describes the increasing gap between assets and liabilities in the course of the Great Recession[fn:Divida_Precos]. 

[fn:Divida_Precos] This co-movement results from the housing prices burst (post-2005) and  the insensitivity of households’ financial commitments. In other words, real estate (assets) has a market value while debt (liabilities) has a contractual one, thus, households net worth decreases
onset of the subprime crisis.


Figure ref:fig:Durables_cycles depicts the association between residential investment and durable goods consumption before, during and after the housing bubble.
From 1992 to 2001, both durable goods consumption and residential investment share increase as long as houses own interest rate decreases.
During the housing bubble (2001-2005), residential investment growth rate increases while houses own interest rate sharply decreases (see Figure ref:propria_investo).
As a result, both residential investment and durable goods consumption share have a relatively constant proportion.
On the aftermath of the housing burst (2005-2009), houses own interest rate increases and is followed by a sharp decrease in both residential investment and durable goods consumption.
Therefore, real estate inflation and durable goods consumption are connected in the U.S. and have relevant implications for the business cycle [fn::textcites:zezza_u.s._2008,barba_rising_2009, for instance, also report that credit-financed consumption was one of the main drivers of economic growth before the Great Recession.]. 





** Gráficos

*** Ciclos 
#+BEGIN_SRC ipython
df = pd.read_csv(
    './data/Cycle.csv',
    index_col = [0],
    parse_dates = True
)
sns.set_context('talk')
fig, ax = plt.subplots(2,3, sharex=True, sharey=True, squeeze=False, figsize=(8,5))

sns.scatterplot(y = 'Housing share', x='TCU', data=df["1970-12":"1975-01"], ax=ax[0,0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["1970-12":"1975-01"], ax=ax[0,0], sort=False, color = 'black')
ax[0,0].set_title("1970 (IV) - 1975 (I)")

sns.scatterplot(y = 'Housing share', x='TCU', data=df["1975-01":"1980-10"], ax=ax[0,1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["1975-01":"1980-10"], ax=ax[0,1], sort=False, color = 'black')
ax[0,1].set_title("1977 (I) - 1980 (III)")

sns.scatterplot(y = 'Housing share', x='TCU', data=df["1980-10":"1982-12"], ax=ax[0,2], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["1980-10":"1982-12"], ax=ax[0,2], sort=False, color = 'black')
ax[0,2].set_title("1980 (III) - 1982 (IV)")

sns.scatterplot(y = 'Housing share', x='TCU', data=df["1982-12":"1991-01"], ax=ax[1,0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["1982-12":"1991-01"], ax=ax[1,0], sort=False, color = 'black')
ax[1,0].set_title("1982 (IV) - 1991 (I)")

sns.scatterplot(y = 'Housing share', x='TCU', data=df["1991-01":"2001-12"], ax=ax[1,1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["1991-01":"2001-12"], ax=ax[1,1], sort=False, color = 'black')
ax[1,1].set_title("1991 (I) - 2001 (IV)")

sns.scatterplot(y = 'Housing share', x='TCU', data=df["2001-12":"2009-07"], ax=ax[1,2], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='TCU', data=df["2001-12":"2009-07"], ax=ax[1,2], sort=False, color = 'black')
ax[1,2].set_title("2001 (IV) - 2009 (II)")


sns.despine()
ax[0,0].set_ylabel(""); ax[1,0].set_xlabel('')
ax[1,0].set_ylabel(""); ax[1,1].set_xlabel(''); ax[1,2].set_xlabel('')

fig.tight_layout(rect=[0, 0.03, 1, 0.90])
fig.text(0.5, 0.03, 'Capacity utilization ratio (Total Industry)', ha='center', fontsize =12)
fig.text(0, 0.5, 'Residential Investment/GDP', va='center', rotation='vertical', fontsize=12)
#fig.tight_layout(rect=[0, 0.03, 1, 1])
plt.show()

fig.savefig("./figs/cycles.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
61 - 6785c99a-cca3-4cbd-bb19-653a26f269e9 <output> <interrupt>
:end:


#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

sns.set_context('paper')
fig, ax = plt.subplots(figsize=(8,5))

df[['Real mortgage interest rate', "Own interest rate", '$g_{I_h}$']].plot(ax=ax, lw=3, color = ("gray", "black", "darkgray"))

sns.despine()
plt.show()
salvar_grafico("Own_gI")
#+END_SRC

#+RESULTS:
:results:
69 - cd33c5d0-e7fb-45d0-94c5-ef129dabef3a <output> <interrupt>
:end:


*** Recessões e taxa de investimento residencial

#+BEGIN_SRC ipython
df = web.DataReader(
    [
        'GDP',
        'PRFI',
    ], 
    'fred', 
    start, end
)
df['H-GDP'] = df['PRFI']/df['GDP']

fig, ax = plt.subplots(figsize=(16, 10))

df['H-GDP'].plot(color = 'black', label = 'Residential investment/GDP', ax = ax, lw=2.5)

#ax.pcolorfast(ax.get_xlim(), ax.get_ylim(),
#              (df['H-GDP'].pct_change() > 0.0).values[np.newaxis],
#              cmap='Blues', alpha=0.3, label="$g_{I_h} > g$",
#              zorder=-1,
#)

#ax.pcolorfast(ax.get_xlim(), ax.get_ylim(),
#              (df['H-GDP'].pct_change() < 0.0).values[np.newaxis],
#              cmap='Reds', alpha=0.3, label="$g_{I_h} < g$", 
#              zorder=-1,
#)

crises(ax)
ax.legend()

sns.despine()
plt.show()
salvar_grafico(file_name="res_share")
#+END_SRC

#+RESULTS:
:results:
# Out [24]: 
# text/plain
: <Figure size 1152x720 with 1 Axes>

# image/png
[[file:obipy-resources/55f4d82f99285b53283e312a47760264590346bb/d77eeea37ad49ce7afc84e37c807a5557fe9f1f6.png]]
:end:

*** Taxa própria


#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py :eval no
from mpl_toolkits.mplot3d import Axes3D
import numpy as np

df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)


fig = plt.figure(
    figsize=(2*8,2*5)
)


ax = fig.add_subplot(1, 1, 1, projection='3d')
tmp_planes = ax.zaxis._PLANES 
ax.zaxis._PLANES = ( tmp_planes[2], tmp_planes[3], 
                     tmp_planes[0], tmp_planes[1], 
                     tmp_planes[4], tmp_planes[5])
view_1 = (25, -135)
view_2 = (25, -45)
init_view = view_1
ax.view_init(*init_view)


start = "1992-01"
end = "2001-12"
# Data for a three-dimensional line
zline = df[start:end]["Durables"]
xline = df[start:end]["Housing share"]
yline = df[start:end]["Own interest rate"]
ax.plot3D(xline, yline, zline, 'darkred', label='1992 (I) - 2001 (IV)', lw=4)
ax.scatter3D(xline, yline, zline, c=df[start:end].index, cmap='Reds', s=[i.timestamp()/10**7 for i in df[start:end].index]);

start = "2001-12"
end = "2005-09"
# Data for a three-dimensional line
zline = df[start:end]["Durables"]
xline = df[start:end]["Housing share"]
yline = df[start:end]["Own interest rate"]
ax.plot3D(xline, yline, zline, 'darkblue', label='2001 (IV) - 2005 (III)', lw=4)
ax.scatter3D(xline, yline, zline, c=df[start:end].index, cmap='Blues', s=[i.timestamp()/10**7 for i in df[start:end].index]);

start = "2005-09"
end = "2009-07"
# Data for a three-dimensional line
zline = df[start:end]["Durables"]
xline = df[start:end]["Housing share"]
yline = df[start:end]["Own interest rate"]
ax.plot3D(xline, yline, zline, 'darkgreen', label='2005 (III) - 2009 (III)',lw=4)
ax.scatter3D(xline, yline, zline, c=df[start:end].index,  cmap='Greens', s=[i.timestamp()/10**7 for i in df[start:end].index]);
#ax.plot(xline, yline, zs=.05, zdir='z', c='k', lw=2); ax.plot(xline, yline, zs=0.05, zdir='z', c='k', lw=2);
#ax.scatter(xline, yline, zs=.05, zdir='z', c=df[start:end].index,  cmap='Greys');


#ax.invert_xaxis()
ax.set_xlabel('\nResidential investment share', linespacing=2.5)
ax.set_ylabel('\nHouses Own interest rate', linespacing=2.5)
ax.zaxis.set_rotate_label(False)  # disable automatic rotation
ax.set_zlabel('Durables Consumption Share', linespacing=2.5,
              rotation=90,
              verticalalignment='baseline',
              horizontalalignment='left');
ax.legend()
sns.despine()

fig.tight_layout()
plt.show()

fig.savefig("./figs/Durables_3D.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
# Out [88]: 
# text/plain
: <Figure size 1152x720 with 1 Axes>

# image/png
[[file:obipy-resources/55f4d82f99285b53283e312a47760264590346bb/1fb6d99995ff6d278760aff7d52468fcc6cf36cc.png]]
:end:

#+BEGIN_SRC ipython
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

fig, ax = plt.subplots(1,3, sharex=True, sharey=True, squeeze=False, figsize=(3*8,5))
sns.scatterplot(y = 'Housing share', x='Own interest rate', data=df["1982-12":"1991-01"], ax=ax[0,0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='Own interest rate', data=df["1982-12":"1991-01"], ax=ax[0,0], sort=False, color = 'black')
ax[0,0].set_title("1982 (IV) - 1991 (I)")

sns.scatterplot(y = 'Housing share', x='Own interest rate', data=df["1991-01":"2001-12"], ax=ax[0,1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='Own interest rate', data=df["1991-01":"2001-12"], ax=ax[0,1], sort=False, color = 'black')
ax[0,1].set_title("1991 (I) - 2001 (IV)")

sns.scatterplot(y = 'Housing share', x='Own interest rate', data=df["2001-12":"2009-07"], ax=ax[0,2], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(y = 'Housing share', x='Own interest rate', data=df["2001-12":"2009-07"], ax=ax[0,2], sort=False, color = 'black')
ax[0,2].set_title("2001 (IV) - 2009 (II)")


sns.despine()
ax[0,0].set_xlabel(""); ax[0,1].set_xlabel(''); ax[0,2].set_xlabel('')
ax[0,0].set_ylabel(""); ax[0,1].set_ylabel(''); ax[0,2].set_ylabel('')

fig.text(0.5, 0.03, 'Houses own interest rate', ha='center', fontsize =9)
fig.text(0, 0.5, 'Residential Investment/GDP', va='center', rotation='vertical', fontsize=9)
fig.tight_layout(rect=[0, 0.03, 1, 1])
plt.show()

fig.savefig("./figs/own_Ih.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
73 - 31a53fd3-2156-4a9e-963d-5e5bfa1b108b <output> <interrupt>
:end:

#+BEGIN_SRC ipython
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

fig, ax = plt.subplots(1,3, sharex=True, sharey=True, squeeze=False, figsize=(3*8,5))
sns.scatterplot(x = 'Housing share', y='Durables', data=df["1982-12":"1991-01"], ax=ax[0,0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Housing share', y='Durables', data=df["1982-12":"1991-01"], ax=ax[0,0], sort=False, color = 'black')
ax[0,0].set_title("1982 (IV) - 1991 (I)")

sns.scatterplot(x = 'Housing share', y='Durables', data=df["1991-01":"2001-12"], ax=ax[0,1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Housing share', y='Durables', data=df["1991-01":"2001-12"], ax=ax[0,1], sort=False, color = 'black')
ax[0,1].set_title("1991 (I) - 2001 (IV)")

sns.scatterplot(x = 'Housing share', y='Durables', data=df["2001-12":"2009-07"], ax=ax[0,2], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Housing share', y='Durables', data=df["2001-12":"2009-07"], ax=ax[0,2], sort=False, color = 'black')
ax[0,2].set_title("2001 (IV) - 2009 (II)")


sns.despine()
ax[0,0].set_xlabel(""); ax[0,1].set_xlabel(''); ax[0,2].set_xlabel('')
ax[0,0].set_ylabel(""); ax[0,1].set_ylabel(''); ax[0,2].set_ylabel('')

fig.text(0.0, 0.3, 'Durables Consumption/GDP', ha='center', fontsize =9, rotation='vertical')
fig.text(0.3, 0.03, 'Residential Investment/GDP', va='center', fontsize=9)
plt.show()

fig.savefig("./figs/Durables_Ih.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
74 - 058bd355-6ca4-4135-92c1-d9a2fab78f1e <output> <interrupt>
:end:

#+BEGIN_SRC ipython
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

fig, ax = plt.subplots(1,3, sharex=True, sharey=True, squeeze=False, figsize=(3*8,5))
sns.scatterplot(x = 'Own interest rate', y='Durables', data=df["1982-12":"1991-01"], ax=ax[0,0], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Own interest rate', y='Durables', data=df["1982-12":"1991-01"], ax=ax[0,0], sort=False, color = 'black')
ax[0,0].set_title("1982 (IV) - 1991 (I)")

sns.scatterplot(x = 'Own interest rate', y='Durables', data=df["1991-01":"2001-12"], ax=ax[0,1], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Own interest rate', y='Durables', data=df["1991-01":"2001-12"], ax=ax[0,1], sort=False, color = 'black')
ax[0,1].set_title("1991 (I) - 2001 (IV)")

sns.scatterplot(x = 'Own interest rate', y='Durables', data=df["2001-12":"2009-07"], ax=ax[0,2], size='Year', sizes = (5,100), color = 'black', legend=False)
sns.lineplot(x = 'Own interest rate', y='Durables', data=df["2001-12":"2009-07"], ax=ax[0,2], sort=False, color = 'black')
ax[0,2].set_title("2001 (IV) - 2009 (II)")


sns.despine()
ax[0,0].set_xlabel(""); ax[0,1].set_xlabel(''); ax[0,2].set_xlabel('')
ax[0,0].set_ylabel(""); ax[0,1].set_ylabel(''); ax[0,2].set_ylabel('')

fig.text(0.0, 0.3, 'Durables Consumption/GDP', ha='center', fontsize =9, rotation='vertical')
fig.text(0.3, 0.03, 'Houses own interest rate', va='center', fontsize=9)
plt.show()

fig.savefig("./figs/Durables_Own.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
75 - fbb7e256-0eb5-4106-89b7-778ca3c61780 <output> <interrupt>
:end:

#+BEGIN_SRC ipython
df = pd.read_csv(
    './data/OwnInterestRate_data.csv',
    index_col = [0],
    parse_dates = True
)

df = df.merge(
    pd.read_csv(
        './data/Cycle.csv',
        index_col = [0],
        parse_dates = True
    ),
    left_index=True, right_index=True
)

df["$g_{DG}$"] = df["PCDG"].pct_change()
sns.set_context('talk')
fig, ax = plt.subplots(1,3, squeeze=False, figsize=(3*8,5))

df.loc["1982-12":"1991-01",["$g_{I_h}$", "Own interest rate", "$g_{DG}$"]].plot(ax=ax[0,0], title = "1982 (IV) - 1991 (I)")
df.loc["1991-01":"2001-12",["$g_{I_h}$", "Own interest rate", "$g_{DG}$"]].plot(ax=ax[0,1], title = "1991 (I) - 2001 (IV)")
df.loc["2001-12":"2009-07",["$g_{I_h}$", "Own interest rate", "$g_{DG}$"]].plot(ax=ax[0,2], title = "2001 (IV) - 2009 (II)")
sns.despine()
plt.show()

fig.savefig("./figs/Durables_Ih_own.png", transparent = True, dpi = 300)
#+END_SRC

#+RESULTS:
:results:
76 - 6a539944-9fc5-40eb-bc88-dd4d7cf03386 <output> <interrupt>
:end:

#+BEGIN_SRC latex :eval no
\begin{figure}[htb]
    \centering
        \caption{Residential investment share Vs. durable goods share Vs. Houses Own interest rate\\\centering Before, during and after housing bubbles\\} 
    \includegraphics[width = 0.75\textwidth]{./figs/Durables_Ih_own.png}
    \label{fig:Durables_cycles}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration.}
\end{figure}
#+END_SRC


*** Curva de concentração

#+BEGIN_SRC ipython 
df = pd.read_excel(
    './data/SCF_merged.xlsx', 
    sheet_name='Riqueza',
    index_col=[0]
)

imoveis = df.loc['Imóveis',:]
imoveis = imoveis.drop(['Percentil da riqueza'], axis='columns')
imoveis.index = [.249, .499, .749, .899, 1]
imoveis = imoveis/100

acoes = df.loc['Ações',:]
acoes = acoes.drop(['Percentil da riqueza'], axis='columns')
acoes.index = [.249, .499, .749, .899, 1]
acoes = acoes/100

secund = df.loc['Secundário',:]
secund = secund.drop(['Percentil da riqueza'], axis='columns')
secund.index = [.249, .499, .749, .899, 1]
secund = secund/100

# Suavizando curvas. Não utilizado
def suavizacao(serie, n=1000, k=2):

    xnew = np.linspace(serie.min().min(), serie.max().max(), n) 
    suavizado = serie.apply(lambda x: make_interp_spline(x.index, x, k=k)(xnew))
    suavizado = suavizado[suavizado > 0].dropna()
    suavizado.index = suavizado.index/n
    return suavizado
#+END_SRC

#+RESULTS:
:results:
# Out [27]: 
:end:

#+BEGIN_SRC ipython
import numpy as np
import matplotlib.patheffects as pe
fig, ax = plt.subplots(figsize=(16, 10))

ax.plot(
    np.linspace(0,0), 
    np.linspace(0,0),
    color='white',
    ls='None',
    label='Primary\n'
)

imoveis.loc[:, imoveis.columns <= 2010].plot(
    ax=ax,
    cmap="gray_r", 
    linewidth=2.5,
    ls = "--",
    path_effects=[pe.Stroke(linewidth=4.0, foreground='k'), pe.Normal()]
)

ax.plot(
    np.linspace(0,0), 
    np.linspace(0,0),
    color='white',
    ls='None',
    label='Secoundary\n'
)

secund.loc[:, secund.columns <= 2010].plot(
    ax=ax,
    cmap="gray_r", 
    linewidth=2.5,
    ls="-.",
    path_effects=[pe.Stroke(linewidth=4.0, foreground='k'), pe.Normal()]
)

ax.legend(ncol=2, frameon=True, facecolor='white', framealpha=2, edgecolor='black')

ax.plot(
    np.linspace(*ax.get_xlim()), 
    np.linspace(*ax.get_xlim()),
    color='black',
    ls='-',
)

ax.arrow(0.6, 0.6, +0.08, -0.08, head_width=0.01, head_length=0.01, fc='gray', ec='black')
ax.text(.61,.53, "Concentration", fontsize=12, rotation=-30)
ax.arrow(0.6, 0.6, -0.07, 0.07, head_width=0.01, head_length=0.01, fc='gray', ec='black')
ax.text(.54,.61, "Deconcentration", fontsize=12, rotation=-30)
ax.text(.8,.75, "Perfect equality line", fontsize=12, rotation=35)

ax.set_xlim(0,1)
ax.set_ylim(0,1)

ax.set_xlabel('Cumulative proportion of Households\n(Households without wealth omiited)')
ax.set_ylabel('Asset cumulative proportion\n(Primary and Secoundary houses)')
ax.secondary_yaxis('right')

plt.show()
salvar_grafico(file_name="Concentration_Curve")
#+END_SRC

#+RESULTS:
:results:
# Out [29]: 
# text/plain
: <Figure size 1152x720 with 1 Axes>

# image/png
[[file:obipy-resources/55f4d82f99285b53283e312a47760264590346bb/cfd37483bc2f485517cf0ddd5c07ad389acfb61b.png]]
:end:


*** Dívida das famílias


#+BEGIN_SRC ipython :async t :results output drawer :session empirical :exports none :tangle ./codes/Empirical_Motivation.py
start = dt(1947, 1, 1)
end = dt(2015, 1, 1)

df = web.DataReader(
    [
        'CMDEBT', # debt securities and loans; liability, Level 
        'CSUSHPINSA', # S&P/Case-Shiller U.S. National Home Price Index
    ], 
    'fred', 
    start, 
    end
)

df.columns = [
    'Household debt',
    'House prices',
]

for i in df.columns:
    df[i] = (df[i]/df[i]['2000-01-01'])*100

df.index.name = ''
df = df.resample("QS").mean().dropna()


fig, ax = plt.subplots(figsize=(16, 10))

df.iloc[df.index>='1970-01',:].plot(
    ax=ax,
    color=('darkred', 'darkblue'),
    linewidth=2.5,
)

crise_subprime(ax)
crises(ax)
ax.legend()


plt.show()
salvar_grafico(file_name="Debt_Prices")
#+END_SRC

#+RESULTS:
:results:
72 - 5e32d5df-13d2-4473-9663-5c39f2b9bbf8 <output> <interrupt>
:end:


* Empirical Motivation                                               :ignore:

** Introduction                                                      :ignore:


@@comment: Parágrafo introdutório: Evidenciar trabalhos com NCC e lacuna do investimento residencial. comment@@
A current trend among empirical research on demand-led growth is about the role of NCC autonomous expenditures.
textcite:freitas_pattern_2013 present a growth accounting decomposition and report the relevance of those expenditures in explaining Brazilian GDP growth between 1970 and 2005. textcite:braga_investment_2018 shows evidence that economic growth and non-residential investment are explained by NCC autonomous expenditures in Brazilian economy from 1962 to 2015. For the U.S., textcite:girardi_long-run_2016 show that NCC autonomous expenditures have permanent effects on growth rate. 
textcite:haluska_growth_2019 employ Granger-causality tests to assess the stability of the SSM for the US (1987-2017) and report a causality from NCC autonomous expenditures to the marginal propensity to invest, as expected.
Finally, textcite:girardi_autonomous_2018 bring evidence that those expenditures determine the investment share on GDP for twenty OECD countries. 


Nevertheless, there still is a lack of studies on the role of residential investment specifically.
Except for textcites:green_follow_1997,leamer_housing_2007, most of those studies were published after the Great Recession (2008-2009).
Additionally, most research on housing has emphasized house prices and not its volume.
textcite:goodhart_house_2008 for instance, estimate a time-series fixed effects panel data for 17 industrialized countries from 1970 to 2006. They report a multidirectional relation between money, credit, house prices and GDP growth and have found stronger effects during housing booms[fn::textcite:Arestis_Bank_2014 also found a  direct relationship between house prices and credit volume based on cointegration and error correction techniques for 9 OECD countries from 1970 to 2011.]. 
textcite:wood_house_2020 report that house prices are relevant for describing household indebtedness from 1980 to 2017 in 18 advance economies.
However, both studies do not include residential investment.
textcite:arestis_residential_2015, on the other side, include residential investment. Using a ARDL model for 17 OECD countries from 1970 to 2013, the authors report that banking credit and real house prices are the most statistically significant variables for real residential investment in the US.


Before we move forward, it worth mentioning that the relevance of residential investment is not restricted to its growth effects nor to the U.S. 
For example, textcite:jorda_great_2016 report that credit and financial sector growth has been led mainly by mortgages for at least 17 OECD countries[fn::As a consequence, banking activities were redirected towards granting credit majorly to households and not to productive investment cites:erturk_banks_2007,kohl_more_2018.]. 
Other studies also have shown that real estate inflation describes household indebtedness and wealth distribution movements and has implications for macroeconomic stability cites:ryoo_household_2016,stockhammer_debt-driven_2016,barnes_private_2016,johnston_global_2017,mian_household_2017,anderson_politics_2020,fuller_housing_2020. 
With regard to the role of residential investment for the Great Recession, textcite:albanesi_credit_2017 shed some light on who were the housing bubble blowers and presented higher default rates: prime rate borrowers[fn::Contrary to the ``Old Narrative'' cite:mian_consequences_2009,  textcite:albanesi_credit_2017  also report that the granting of credit and the default rate among those with the worst risk assessment remained constant throughout the housing bubble.].

From this review of recent empirical literature, it is noticeable that few macroeconometric studies have investigated residential investment in any systematic way.
In this paper, we argue that besides this growing body of literature that recognizes the macroeconomic importance of residential investment, little progress has been made in understanding its theoretical determinants.
On the following subsection, we present some residential investment-related stylized facts in order to highlight its relevance for the US business cycle.
Next, we analyze the connection between residential investment, real estate inflation and mortgage interest rate during the U.S. housing bubble episode.

** Residential investment stylized facts

*** Investmento residencial e o ciclo econômico                      :ignore:

In this subsection, we show some residential investment stylized facts for the US.
Both cites:green_follow_1997,leamer_housing_2007 made it clear how important this particular expenditure is to USA business cycle.
More precisely,  \textcite[p.~8]{leamer_housing_2007} describes US business cycles as follows: ''[f]irst homes, then cars,
and last business equipment''.
Figure ref:Investo_Resid_GDP shows how the behavior of residential dynamics can help to predict recessions. Recessions are anticipated by a reduction of residential investment share of GDP, while the expansion of those expenditures precedes economic recovery. The fall of dwellings expenditures in 1966-67 are an exception because the increase of military expenditures because of Vietnam War offset an eventual economic downturn \cite[p.~20]{leamer_housing_2007}. Another exception is the dot-com bubble 2000 crisis that was not caused by residential investment. The Great Recession 2008-2009 is the one in which this pattern is the most evident. 



#+begin_export latex
\begin{figure}[htb]
    \centering
        \caption{Residential Investment as share of GDP}
        \label{Investo_Resid_GDP}
    \includegraphics[width = 0.7\textwidth]{./figs/res_share.png}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration}
\end{figure}
#+end_export



@@comment: Importância do investimento residencial para o ciclo econômico comment@@
In order to depict the relation between housing and business cycle, we present Figure ref:fig:cycles in which each cycle is represented in a different panel[fn::This similar reasoning can be found in textcite:fiebiger_trend_2017. Unlike them, we plot only residential investment without including other households expenses financed by credit.].
The vertical axis represents residential investment-GDP ratio and the horizontal axis represents the capacity utilization ratio  as a proxy for business cycle. Economic recovery is generally characterized by residential investment growing faster than GDP — with the 1991-2000 period being a particular case. Both residential investment share on GDP and capacity utilization increase as a consequence of this higher growth rate.
Following the Sraffian supermultiplier growth model, we conclude that increase of non-residential investment is the result of capital stock adjustment principle[fn::textcites:fiebiger_semi-autonomous_2018,fiebiger_trend_2017 also report residential investment as an important determinant of business cycles. Those works associate economic instability to the behavior of (at least some) autonomous expenditures in spite of the behavior firms investment --- as it follows capital stock adjustment principle. textcites:dejuan_hidden_2017,teixeira_crescimento_2015 find similar results.]. This increase implies GDP to grow faster than residential investment, therefore reducing both its share on GDP and capacity utilization ratio. Finally, as a result of economic burst, capacity utilization ratio falls and the cycle ends.



#+BEGIN_SRC latex
\begin{figure}[htb]
    \centering
        \caption{Share of residential investment and capacity utilization during business cycles\\\centering (Dots size grow in  time)} 
    \includegraphics[width = 0.65\textwidth]{./figs/cycles.png}
    \label{fig:cycles}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration.}
\end{figure}
#+END_SRC

#+RESULTS:
#+begin_export latex
\begin{figure}[htb]
    \centering
        \caption{Share of residential investment and capacity utilization during business cycles\\\centering (Dots size grow in  time)} 
    \includegraphics[width = 0.65\textwidth]{./figs/cycles.png}
    \label{fig:cycles}
    \caption*{\textbf{Source:} Federal Reserve Bank of St. Louis, authors’ elaboration.}
\end{figure}
#+end_export

*** Curva de Concentração                                            :ignore:


Another key aspect of recent housing development is the  popularization of primary houses and concentration of secondary ones[fn::According to textcite:us_census_bureau_characteristics_2017, a primary property is one that the owner has regular access to and, in the case of having more than one (secondary) property, it is the one that enjoys most of the time throughout the year. Secondary properties are those where:
(i) the owners reside part of the year only; (ii) it is at least 50 miles from the primary property and; (iii) cannot be subject to a rental agreement.]. The expansion of primary houses can be seen in Figure ref:fig:concentration, which shows the concentration curve from 1989 to 2010 by different types of properties (primary and secondary)[fn::Concentration curves are drawn from the cumulative ordering of two distinct variables. The horizontal axis of Figure ref:fig:concentration contains the cumulative proportion of wealthy households while the vertical axis shows the accumulated proportion of a portion of this wealth (in this case, primary and secondary houses). Finally, to build the concentration curves, both axes are ordered by total wealth. Thus, unlikely the Lorenz curve, concentration curves are non-decreasing. As a consequence, it can cross the perfect equality line. For more details, see textcite:Jann_Concentration_2016.]. Based on these curves, it is possible to assess how concentrated a certain asset is by comparing it with perfect equality line[fn::In 2010, for example,  up to 25% of wealthy households owned 21.80% of all primary houses. Moving on, households up to 50%, 75% and 90% owned 61.30%, 90.10% and  95.30% respectively while 2.9% was not in the possession of any households.][fn::The higher and to the left a concentration curve is compared to the Lorenz curve, the less concentrated the asset is. In this case, the asset  is distributed in favor of the poorest strata of wealth. A concentration curve more to the right and below compared to the Lorenz curve indicates the opposite.].

#+begin_export latex
\begin{figure}[htb]
    \centering
        \caption{Concentration curves for primary and secoundary houses} 
    \includegraphics[width = 0.95\textwidth]{./figs/Concentration_Curve.png}
    \label{fig:concentration}
    \caption*{\textbf{Source:} Survey of Consumer Finance, authors’ elaboration.}
\end{figure}
#+end_export


A brief inspection of Figure ref:fig:concentration reveals that the years leading up to the Great Recession were characterized by the deconcentration of primary houses. In other words, poorer strata of the population now have a larger accumulated share of this type of asset. 
Since primary houses concern those that are used for purposes that are not necessarily speculative, there is a general increase in the demand for properties as final good. The same cannot be said about secondary houses whose concentration/distribution movement is not as marked as in the previous case. Since this type of property is not intended for regular use by its owner, a greater distribution of this asset suggests an increase in the demand for properties in the expectation of capital gains[fn::This increase in demand for secondary houses may indicate --- but is not limited to --- an increase for speculative reasons. A vacation or rental home, for example, are non-speculative uses of a secondary house. Nevertheless, it is argued that there is a connection between secondary houses and speculation with real estate. It worth noting that the wealthiest households are not the main holders of this secoundary houses. According to Figure ref:fig:concentration, they accumulate less than 50% of these properties over the analyzed period (see vertical axis).].

*** Conexão com a subseção seguinte


** Housing bubble and residential investment


After the Great Recession, the literature have analyzed the macroeconomic relevance of residential investment cites:leamer_housing_2015,fiebiger_semi-autonomous_2018.
However, little progress has been made in understanding its theoretical determinants.
textcite:teixeira_crescimento_2015 proposes the so-called houses own interest rate ($own$) in order to analyze the relation between residential investment, real estate inflation and interest rates during the U.S. housing bubble episode.
Estimated by deflating mortgages interest rate real estate inflation, this particular real interest rate is the most relevant for households since it is the real cost in real estate from buying real estate  \cite[p.~53]{teixeira_crescimento_2015}.
In short, this is the real interest rate that is relevant for house investors.
Figure ref:propria_investo shows how this  procedure is more adequate than a general price index deflation --- as \textcite[p.~143--6]{fair_macroeconometric_2013} does --- to describe residential investment growth rate[fn::It is worth noting that during a housing bubble period, it is real estate inflation that governs own's interest rate dynamics. Therefore, the lower this rate is, the greater the capital gains (in real estate) for speculating with real estate will be. This negative relation between houses own interest rate and residential investment is shown in Figure \ref{propria_investo} in which this particular real interest rate has been gradually decreased over the real estate boom (2002-5).].
Based on this concept, textcite:petrini_demanda_2019 estimated an econometric model for the U.S. (1992 to 2019) and presents empirical evidence that the residential investment growth rate and houses own interest rate share a common negative long-run trend.
Furthermore, textcite:petrini_demanda_2019 also reports a unidirectional long-run causality from houses own interest rate to residential investment growth rate.

EXPLICAR TAXA PRÓPRIA


#+BEGIN_SRC latex
\begin{figure}[htb]
	\centering
	\caption{Residential investment growth rate vs. Houses Own interest rate}
	\label{propria_investo}
	\includegraphics[width=.8\textwidth]{./figs/Own_gI}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' elaboration}
\end{figure}
#+END_SRC

#+RESULTS:
#+begin_export latex
\begin{figure}[htb]
	\centering
	\caption{Residential investment growth rate vs. Houses Own interest rate}
	\label{propria_investo}
	\includegraphics[width=.8\textwidth]{./figs/Own_gI}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' elaboration}
\end{figure}
#+end_export





In summary, what we intended to show is that one cannot analyze the U.S. business cycle properly without considering residential investment and asset bubbles together.





