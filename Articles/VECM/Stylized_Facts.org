* Residuals :noexport:

To do so, they estimate a Structural Vector Autoregressive (SVEC) model with wavelets transformation for the US and G7 countries.
They find residential investment is not only a monetary policy transmission channel, but it also has temporally distinct effects on business cycle.
In the short-run, housing is more predictive while house prices have a bigger influence in the long-run[fn::
	More precisely, textcite:huang_is_2018 also conclude that residential investment prediction increases with its share on GDP.
	].
These distinct temporal influence of housing occurs due to the large wealth effect in the long-run while credit and collateral effects are more relevant in the short-run.
#+begin_quote
    ``[...] Housing is by far the best aid to recovery because of the large and continuing scale
of potential demand; because of the wide geographical distribution of this demand; and
because the sources of its finance are largely independent of the stock exchanges. I should
advise putting most of your eggs in this basket, caring about this more than about anything,
and making absolutely sure that they are being hatched without delay. In this country we
partly depended for many years on direct subsidies. There are few more proper objects for
such than working-class houses. If a direct subsidy is required to get a move on (we gave
our subsidies through the local authorities), it should be given without delay or hesitation.''
\cite[p.~436]{keynes_collected_1978}
#+end_quote

As the above excerpt suggests, the relevance of housing is not restricted to the Great Recession nor the USA case.

We also report an indirect relation between housing and aggregate demand.
Real estate constitutes a significant portion of household wealth so houses serves as collateral to borrowing cite:teixeira_uma_2011.
As a consequence of US institutional arrangement, households --- especially the poorest ones --- could increase their indebtedness as houses prices went up (see Figure ref:FigDividaPreco) as a way to ``make'' capital gains without
selling their homes during house bubble of the 2000s cite:teixeira_crescimento_2015.
Therefore, real estate inflation and durable goods consumption are connected and has relevant consequences for business cycle.
textcites:zezza_u.s._2008,barba_rising_2009, for example, report that credit-financed consumption was one of the main drivers of economic growth before the Great Recession.


In this paper, we argue that this relation between households indebtedness and real estate inflation has other relevant implications.
The first one is the increasing gap between assets and liabilities in the course of the Great Recession.
This dynamic is due both to the housing prices burst (post-2005) and to the insensitivity of households' financial commitments.
In other words, real estate (assets) has a market value while debt (liabilities) has a contractual one, thus, households net worth decreases onset of the subprime crisis.
Therefore, the second implication is the sharp reduction in the net worth of the poorest households in absolute and relative terms (see Figure ref:FigDistPassivos).

#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Household indebtedness and house prices dynamics (jan/2000=100)}
	\label{FigDividaPreco}
	\includegraphics[width=\textwidth]{./figs/Divida_PrecoImoveis.png}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' Elaboration}
\end{figure}

\begin{figure}[H]
	\centering
	\caption{Liabilities evolution by wealth percentile (1989/07=1)}
	\label{FigDistPassivos}
	\includegraphics[width=.8\textwidth]{./figs/Distribuicao_Passivos.png}
	\caption*{\textbf{Source:} \textcite{us_census_bureau_characteristics_2017}, Authors' Elaboration}
\end{figure}
#+end_export


* Configs :noexport:
bibliography:ref.bib
#+PROPERTY: header-args:python :results output drawer :session empirical :exports none :tangle ./Stylized_Facts.py :eval never-export :python /usr/bin/python3

** Packages
#+begin_src python
from datetime import datetime as dt

t1 = dt.now()

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.api as sm
plt.rc('axes', titlesize=22)     # fontsize of the axes title
plt.rcParams.update({"font.size": 15})
import pandas_datareader.data as web

from scipy.interpolate import make_interp_spline, BSpline  # Smooth plot

sns.set(style="whitegrid")
sns.set_context("paper")
#+end_src

#+RESULTS:
:results:
:end:


** Functions and variables

#+begin_src python
plt.rc('legend', fontsize=14)    # legend fontsize
def crise_subprime(axes, alpha=0.4):
    axes.axvspan(
        xmin="2007-12-01",
        xmax="2009-06-01",
        color="gray",
        label="subprime crisis",
        zorder=0,
        alpha=alpha,
    )


def crises(axes, color="lightgray", alpha=0.4):
    axes.axvspan(
        xmin="1953-07", xmax="1954-04", color=color, alpha=alpha, label="Recession"
    )
    axes.axvspan(xmin="1957-08", xmax="1958-05", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1960-05", xmax="1961-02", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1969-12", xmax="1970-11", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1973-11", xmax="1975-03", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1980-01", xmax="1980-07", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1981-07", xmax="1982-01", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="1990-07", xmax="1991-03", color=color, alpha=alpha, label="")
    axes.axvspan(xmin="2001-03", xmax="2001-11", color=color, alpha=alpha, label="")


start = dt(1949, 1, 1)
end = dt(2019, 1, 1)
recessions = web.get_data_fred("USRECM", start, end)
recessions.columns = ["Recessions"]
recessions["xmin"] = False
recessions["xmax"] = False
for i in range(len(recessions["Recessions"]) - 1):
    recessions.iscopy = True
    if (
        recessions["Recessions"].iloc[i] == 0
        and recessions["Recessions"].iloc[i + 1] == 1
    ):
        recessions["xmin"].iloc[i + 1] = True
    elif (
        recessions["Recessions"].iloc[i] == 1
        and recessions["Recessions"].iloc[i + 1] == 0
    ):
        recessions["xmax"].iloc[i + 1] = True


def recessions_bars(ax):
    import matplotlib.pyplot as plt

    xmin = recessions[recessions["xmin"] == True]["xmin"]
    xmax = recessions[recessions["xmax"] == True]["xmax"]

    for i in range(len(xmax)):
        ax.axvspan(xmin=xmin.index[i], xmax=xmax.index[i], alpha=0.3, color="k")


def default_plot():
    plt.xlabel("")
    sns.set_context("talk")
    plt.rcParams["axes.edgecolor"] = "#333F4B"
    plt.rcParams["axes.linewidth"] = 0.8
    plt.rcParams["xtick.color"] = "#333F4B"
    plt.rcParams["ytick.color"] = "#333F4B"
    ax.grid(False)
    ax.spines["top"].set_color("none")
    ax.spines["right"].set_color("none")
    ax.spines["left"].set_smart_bounds(True)
    ax.spines["bottom"].set_smart_bounds(True)
    sns.despine()


def salvar_grafico(file_name, extension="png", pasta="./figs/"):
    fig.savefig(
        pasta + file_name + "." + extension,
        dpi=600,
        bbox_inches="tight",
        format=extension,
        pad_inches=0.2,
        transparent=False,
    )
#+end_src

#+RESULTS:
:results:
/home/gpetrini/.local/lib/python3.8/site-packages/pandas/core/indexing.py:670: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  iloc._setitem_with_indexer(indexer, value)
:end:

** Endividamento das famílias e preço dos imóveis


#+begin_src python :results graphics file :file ./figs/Divida_PrecoImoveis.png
start = dt(1947, 1, 1)
end = dt(2015, 1, 1)

df = web.DataReader(
    [
        "CMDEBT",  # debt securities and loans; liability, Level
        "CSUSHPINSA",  # S&P/Case-Shiller U.S. National Home Price Index
    ],
    "fred",
    start,
    end,
)

df.columns = [
    "Household debt",
    "House prices",
]

for i in df.columns:
    df[i] = (df[i] / df[i]["2000-01-01"]) * 100

df.index.name = ""
df = df.resample("QS").mean().dropna()

fig, ax = plt.subplots(figsize=(19.2, 10.8))

df.iloc[df.index >= "1970-01", :].plot(
    ax=ax,
    color=("darkred", "darkblue"),
    linewidth=2.5,
)

crise_subprime(ax)
crises(ax)
ax.legend()
ax.tick_params(axis="both", which="major", labelsize=15)
ax.set_title("Jan/2000 = 100", fontsize=22)
plt.close()
salvar_grafico(file_name="Divida_PrecoImoveis")
#+end_src

#+RESULTS:
[[file:./figs/Divida_PrecoImoveis.png]]

** Household credit

#+begin_src python :results graphics file :file ./figs/FIDCIA.png
start = dt(1945, 1, 1)
end = dt(2015, 1, 1)

df = web.DataReader(
    [
        'BOGZ1FL154104015Q', # home mortgages and consumer credit; liability, Level
        'HHMSDODNS', # home mortgages; liability, Level
    ],
    'fred',
    start,
    end
)

df.columns = [
    'Household credit',
    'Mortgages'
]

df.index.name = ''
df = df.pct_change(4).dropna()


fig, ax = plt.subplots(figsize=(19.2, 10.8))

df.iloc[df.index>='1978-01',:].plot(
    ax=ax,
    linewidth=2.5,
    color=('darkred', 'darkblue')
)

crise_subprime(ax)
crises(ax)
ax.axvline(
    x="1991-12-19",
    label='FDICIA',
    color='black',
    ls='-',
    linewidth=1.75
)
ax.axvline(
    x="1989-02-06",
    label='FIRREA',
    color='black',
    ls='--',
    linewidth=1.75
)

ax.legend(fontsize=14)

ax.text(
    s = "Fed. Deposit Insurance \nCorp. Improvement Act \n(FDICIA)",
    y = 0.17,
    x="1992-06-01",
    fontsize=12,
       )

ax.text(
    s = "Fin. Instit. Reform, Recovery, \nand Enactment Act (FIRREA)",
    y = 0.,
    x="1988-08-01",
    fontsize=12,
    horizontalalignment='right'
       )

ax.tick_params(axis="both", which="major", labelsize=15)

sns.despine()
plt.close()
salvar_grafico(file_name="FDICIA")
#+end_src

** Demanda agregada

#+BEGIN_SRC python
from matplotlib.patches import Ellipse, Polygon

start = dt(1979, 1, 1)
end = dt(2020, 12, 31)

df = web.get_data_fred(
    [
        "PCEC",  # Personal consuption
        "PNFI",  # Private non-residential fixed investment
        "PRFI",  # Private residential fixed investment
        "GCE",  # Governement expenditures
        "EXPGS",  # Exports
    ],
    start,
    end,
)

df.columns = [
    "Personal consumption expend.",
    "Non Residential investment",
    "Residential investment",
    "Government Expenditures",
    "Exports",
]


df["AD"] = df.sum(axis=1)

df = df.resample("QS").mean()
df.index.name = ""
df = df.apply(lambda x: x / df["AD"]).drop(["AD"], axis="columns")
fig, ax = plt.subplots(1, 1, figsize=(19.2, 10.8))


df.plot(
    kind="area",
    stacked=True,
    ax=ax,
    legend=False,
    color=(
        "#000000",
        "#333333",
        "#ffffff",
        "#888888",
        "#cccccc",
    ),
)

df.plot(kind="line", stacked=True, ax=ax, legend=False, color="white", label=None)

handles, labels = ax.get_legend_handles_labels()
ax.legend(
    handles[:4:-1],
    labels[:4:-1],
    loc="center left",
    bbox_to_anchor=(1, 0.5),
    title="Expenditures (in order)",
    title_fontsize=18,
)

# ax.text('1980', 0.2, s=df.columns[0], color="white", fontsize=18, fontfamily='serif')
# ax.text('1980', 0.6, s=df.columns[1], color="white", fontsize=18, fontfamily='serif')
# ax.text('1980', 0.7, s=df.columns[2], color="black", fontsize=18, fontfamily='serif')
# ax.text('1980', 0.8, s=df.columns[3], color="black", fontsize=18, fontfamily='serif')
# ax.text('1980', 0.95, s=df.columns[4], color="black", fontsize=18, fontfamily='serif')


ax.set_ylim(0, 1)
ax.set_xlabel("")
ax.tick_params(axis="both", which="major", labelsize=15)

sns.despine()
plt.tight_layout()
plt.close()
salvar_grafico(file_name="Share_AD")
#+END_SRC

#+RESULTS:
:results:
:end:

** Volatilidade e participação

#+begin_src python :results graphics file :file ./figs/subplots.png
start = dt(1947, 1, 1)
end = dt(2015, 1, 1)

df = web.DataReader(
    [
        "PRFI",  # Domestic business
        "PNFI",  # Households and institutions
        "GDP",  # Gross Domestic Product
    ],
    "fred",
    start,
    end,
)

df.columns = ["Residential", "Non-Residential", "GDP"]
df.index.name = ""
df = df.pct_change(4).dropna()
df = df.dropna()

df["Great Recession"] = [
    "Pre Crisis" if i < dt(2009, 1, 1) else "Post Crisis" for i in df.index
]
df["Great Recession"] = df["Great Recession"].astype("category")
df = pd.melt(
    df, value_vars=["Residential", "Non-Residential", "GDP"], id_vars="Great Recession"
)


share = web.get_data_fred(
    ["GDP", "EXPGS", "GCE", "PRFI", "HCCSDODNS", "PRFI", "PCEC", "IMPGS"],  #'TOTALSL',
    start,
    end,
)

share.columns = [
    "GDP",
    "Exports",
    "Gov. expenditures",
    "Residential investment",
    "Consumer credit",
    "Non-residential investment",
    "Consumption",
    "Importações",
]

Z = ["Exports", "Gov. expenditures", "Residential investment", "Consumer credit"]

share["Autonomos"] = share[Z].sum(axis=1)

share = share.resample("QS").mean()
share = share["1979":]
share.index.name = ""

fig, ax = plt.subplots(1, 2, figsize=(19.2, 10.8))

sns.violinplot(
    x="variable",
    y="value",
    # hue="Great Recession",
    palette="Greens",
    ax=ax[0],
    lw=2,
    data=df,
    split=True,
    scale="area",
)


ax[0].axhline(y=0, ls="--", color="black", zorder=0)
ax[0].set_xlabel("")
ax[0].set_ylabel("Growth rate", fontsize=15)
ax[0].set_title("A - Selected growth rate\ndistribution (1947-2019)", fontsize=22)
ax[0].tick_params(axis="both", which="major", labelsize=15)

share[Z].apply(lambda x: x / share["GDP"]).plot(
    kind="area",
    stacked=True,
    ax=ax[1],
    legend=False,
    color=(
        "black",
        "grey",
        "darkred",
        "lightgrey",
    ),
)

share[Z].apply(lambda x: x / share["GDP"]).plot(
    kind="line", stacked=True, ax=ax[1], legend=False, color="black", label=None
)

handles, labels = ax[1].get_legend_handles_labels()
ax[1].legend(
    handles[:3:-1],
    labels[:3:-1],
    #             loc='center left', bbox_to_anchor=(1, 0.5)
)
ax[1].set_ylim(0, 1)
ax[1].set_xlabel("")
ax[1].set_title(
    "B - Autonomous expenditures\nshare on GDP (US, 1979-2019)", fontsize=22
)
ax[1].tick_params(axis="both", which="major", labelsize=15)

sns.despine()
plt.tight_layout()
plt.close()
plt.subplots_adjust(wspace=0.2)
salvar_grafico(file_name="Volatility_share")
#+end_src

#+RESULTS:
[[file:./figs/subplots.png]]

** Passivos por percentil de riqueza

#+begin_src python  :results graphics file :file ./figs/Distribuicao_Passivos.png
def concentracao_df(df):
    colunas = ['Top 1%', 'Top 10%', 'Top 50-90%', 'Bottom 50%']
    df.columns = colunas
    df = df/100
    df.index.name = ''
    df = df/df.iloc[0,:]
    return df

start = dt(1947, 1, 1)
end = dt(2015, 1, 1)
url = 'https://fred.stlouisfed.org/release/tables?rid=453&eid=813804#snid=813936'

passivos = web.DataReader(
    [
        'WFRBST01127', # Share of Total Liabilities Held by the Top 1% (99th to 100th Wealth Percentiles)
        'WFRBSN09154', # Share of Total Liabilities Held by the 90th to 99th Wealth Percentiles
        'WFRBSN40181', # Share of Total Liabilities Held by the 50th to 90th Wealth Percentiles
        'WFRBSB50208', # Share of Total Liabilities Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    'fred',
    start,
    end
)
passivos = concentracao_df(passivos)

emprestimo = web.DataReader(
    [
        'WFRBST01128', # Share of Loans (Liabilities) Held by the Top 1% (99th to 100th Wealth Percentiles)
        'WFRBSN09155', # Share of Loans (Liabilities) Held by the 90th to 99th Wealth Percentiles
        'WFRBSN40182', # Share of Loans (Liabilities) Held by the 50th to 90th Wealth Percentiles
        'WFRBSB50209', # Share of Loans (Liabilities) Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    'fred',
    start,
    end
)
emprestimo = concentracao_df(emprestimo)

Mortgages = web.DataReader(
    [
        'WFRBST01129', # Share of Home mortgages Held by the Top 1% (99th to 100th Wealth Percentiles)
        'WFRBSN09156', # Share of Home mortgages Held by the 90th to 99th Wealth Percentiles
        'WFRBSN40183', # Share of Home mortgages Held by the 50th to 90th Wealth Percentiles
        'WFRBSB50210', # Share of Home mortgages Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    'fred',
    start,
    end
)
Mortgages = concentracao_df(Mortgages)

patrimonio_liq = web.DataReader(
    [
        'WFRBST01134', # Share of Total Net Worth Held by the Top 1% (99th to 100th Wealth Percentiles)
        'WFRBSN09161', # Share of Total Net Worth Held by the 90th to 99th Wealth Percentiles
        'WFRBSN40188', # Share of Total Net Worth Held by the 50th to 90th Wealth Percentiles
        'WFRBSB50215', # Share of Total Net Worth Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    'fred',
    start,
    end
)
patrimonio_liq = concentracao_df(patrimonio_liq)

fig, ax = plt.subplots(2, 2, figsize=(19.2, 10.80), sharey=True)

passivos.plot(title='A - Total Liabilities', ax=ax[0,0], legend=False, lw=3)
emprestimo.plot(title='B - Loans', ax=ax[0,1], legend=False, lw=3)
Mortgages.plot(title='C - Mortgages', ax=ax[1,0], legend=False, lw=3)
patrimonio_liq.plot(title='D - Net Worth', ax=ax[1,1], legend=False, lw=3)

crise_subprime(axes=ax[0,1])
crises(axes=ax[0,1])
ax[0,1].legend(loc='center left', bbox_to_anchor=(1.1, 0.), fontsize=18)

crise_subprime(axes=ax[0,0])
crise_subprime(axes=ax[1,0])
crise_subprime(axes=ax[1,1])
crises(axes=ax[0,0])
crises(axes=ax[1,0])
crises(axes=ax[1,1])

ax[0,0].set_title('A - Total Liabilities', fontsize=18)
ax[0,1].set_title('B - Loans', fontsize=18)
ax[1,0].set_title('C - Mortgages', fontsize=18)
ax[1,1].set_title('D - Net Worth', fontsize=18)

ax[0,0].tick_params(axis="both", which="major", labelsize=15)
ax[0,1].tick_params(axis="both", which="major", labelsize=15)
ax[1,0].tick_params(axis="both", which="major", labelsize=15)
ax[1,1].tick_params(axis="both", which="major", labelsize=15)

sns.despine()
plt.tight_layout()
plt.close()
salvar_grafico(file_name="Distribuicao_Passivos")
#+end_src
*** Hipotecas e imóveis
#+begin_src python  :results graphics file :file ./figs/Houses_Mortgages.png
def concentracao_df(df):
    colunas = ["Top 1%", "Top 10%", "Top 50-90%", "Bottom 50%"]
    df.columns = colunas
    df = df / 100
    df.index.name = ""
    df = df / df.iloc[0, :]
    return df


start = dt(1947, 1, 1)
end = dt(2019, 1, 1)
url = "https://fred.stlouisfed.org/release/tables?rid=453&eid=813804#snid=813936"

houses = web.DataReader(
    [
        "WFRBST01110",  # Share of Real Estate Held by the Top 1% (99th to 100th Wealth Percentiles)
        "WFRBSN09137",  # Share of Real Estate Held by the 90th to 99th Wealth Percentiles
        "WFRBSN40164",  # Share of Real Estate Held by the 50th to 90th Wealth Percentiles
        "WFRBSB50191",  # Share of Real Estate Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    "fred",
    start,
    end,
)
houses = concentracao_df(houses)

Mortgages = web.DataReader(
    [
        "WFRBST01129",  # Share of Home mortgages Held by the Top 1% (99th to 100th Wealth Percentiles)
        "WFRBSN09156",  # Share of Home mortgages Held by the 90th to 99th Wealth Percentiles
        "WFRBSN40183",  # Share of Home mortgages Held by the 50th to 90th Wealth Percentiles
        "WFRBSB50210",  # Share of Home mortgages Held by the Bottom 50% (1st to 50th Wealth Percentiles)
    ],
    "fred",
    start,
    end,
)
Mortgages = concentracao_df(Mortgages)


fig, ax = plt.subplots(1, 2, figsize=(19.2, 10.80), sharey=True)

houses.plot(title="A - Houses", ax=ax[0], legend=False, lw=3)
Mortgages.plot(title="B - Mortgages", ax=ax[1], legend=False, lw=3)

crise_subprime(axes=ax[0])
crise_subprime(axes=ax[1])
crises(axes=ax[0])
crises(axes=ax[1])
ax[1].legend(loc="center left", bbox_to_anchor=(1.1, 0.5), fontsize=18)

crise_subprime(axes=ax[0])
crise_subprime(axes=ax[1])
crises(axes=ax[0])
crises(axes=ax[1])

ax[0].set_title("A - Houses", fontsize=18)
ax[1].set_title("B - Mortgages", fontsize=18)

ax[0].tick_params(axis="both", which="major", labelsize=15)
ax[1].tick_params(axis="both", which="major", labelsize=15)

sns.despine()
plt.tight_layout()
plt.close()
salvar_grafico(file_name="Houses_Mortgages")
#+end_src

#+RESULTS:
[[file:./figs/Houses_Mortgages.png]]

** Crisis centered plot
*** Begin
#+begin_src R :session *centered* :results graphics file :file ./figs/Centered_Begin_pct1.png :eval never-export :exports none
library(tidyverse)
library(purrr)
library(fredr)
library(lubridate)

begin <- c('1953-07-01', '1957-08-01', '1960-04-01', '1969-12-01', '1973-11-01', '1980-01-01', '1981-07-01', '1990-07-01', '2001-03-01', '2007-12-01')
end <- c('1954-06-01', '1958-05-01', '1961-03-01', '1970-12-01', '1975-04-01', '1980-08-01', '1982-12-01', '1991-04-01', '2001-12-01', '2009-07-01')


df <-  map_dfr(
  c("GDP", "PRFI", "PNFI", "HCCSDODNS", "USRECM"),
  fredr,
  units = "pc1", # pct from 1 year ago
  frequency = 'q'
) %>%
  select(date, series_id, value) %>%
  pivot_wider(names_from = series_id, values_from= value) %>%
  mutate(
    recessions = as.logical(USRECM),
    `Residential Investment` = PRFI,
    `Non Residential Investment` = PNFI,
    `Durable Goods` = HCCSDODNS
  ) %>%
  select(date, recessions, GDP, `Residential Investment`, `Non Residential Investment`, `Durable Goods`) %>%
  mutate(crise = case_when(
           (date >= ymd(begin[1]) %m+% years(-2) & date <= ymd(begin[1]) %m+% years(2)) ~ begin[1] %>% substr(1,7),
           (date >= ymd(begin[2]) %m+% years(-2) & date <= ymd(begin[2]) %m+% years(2)) ~ begin[2] %>% substr(1,7),
           (date >= ymd(begin[3]) %m+% years(-2) & date <= ymd(begin[3]) %m+% years(2)) ~ begin[3] %>% substr(1,7),
           (date >= ymd(begin[4]) %m+% years(-2) & date <= ymd(begin[4]) %m+% years(2)) ~ begin[4] %>% substr(1,7),
           (date >= ymd(begin[5]) %m+% years(-2) & date <= ymd(begin[5]) %m+% years(2)) ~ begin[5] %>% substr(1,7),
           (date >= ymd(begin[6]) %m+% years(-2) & date <= ymd(begin[7]) %m+% years(2)) ~ paste(begin[6] %>% substr(1,7), "and", begin[7] %>% substr(1,7)),
           ## (date >= ymd(begin[7]) %m+% years(-2) & date <= ymd(begin[7]) %m+% years(2)) ~ begin[7],
           (date >= ymd(begin[8]) %m+% years(-2) & date <= ymd(begin[8]) %m+% years(2)) ~ begin[8] %>% substr(1,7),
           (date >= ymd(begin[9]) %m+% years(-2) & date <= ymd(begin[9]) %m+% years(2)) ~ begin[9] %>% substr(1,7),
           (date >= ymd(begin[10]) %m+% years(-2) & date <= ymd(begin[10]) %m+% years(2)) ~ begin[10] %>% substr(1,7)
         )) %>%
  ## mutate(crise = substr(crise, 1,7)) %>%
  mutate(crise = crise %>% as.character() %>% as.factor()) %>%
  pivot_longer(cols = -c(date, crise, recessions), names_to="Series", values_to = "value") %>%
  ## mutate(Series = as.factor(Series)) %>%
  filter(date>=ymd('1979-01-01') & date <=ymd('2011-01-01')) %>%
  drop_na(crise)

ggplot(df, aes(x=date, y=value, colour=Series, linetype=Series)) +
  geom_line() +
  scale_x_date(breaks = "year", minor_breaks = "6 months", date_labels="%y' %b") +
  ## ggsci::scale_color_futurama() +
  facet_wrap(~crise, scale="free_x", drop=TRUE) +
  geom_hline(yintercept=0, color='black', size=0.25) +
  xlab("") + ylab("Percent change from 1 year ago") +
  theme_bw() +
  scale_color_manual(name = "Series",
                     values = c('black', 'black', 'grey', 'black'),
                     labels = c("Durable Goods", "GDP", "Non Residential Investment", "Residential Investment")) +
  scale_linetype_manual(name = "Series", 
                        values = c("solid", "dashed", "solid", "dotted"),
                        labels = c("Durable Goods", "GDP", "Non Residential Investment", "Residential Investment")) ->fig

for(i in begin){
  if(ymd(i) >= ymd('1980-01-01')){
    fig + geom_vline(xintercept = as.numeric(ymd(i)), linetype="solid",
                color = "black", size=.25) -> fig
  }
}

ggsave(
  "./figs/Centered_Begin_pct1.png",
  width = 10, height = 8, dpi = 150, units = "in", device = "png"
)
#+end_src

#+RESULTS:
[[file:./figs/Centered_Begin_pct1.png]]









*** End
#+begin_src R :session *centered* :results graphics file :file ./figs/Centered_End_pct1.png :eval never-export :exports none

end <- c('1954-06-01', '1958-05-01', '1961-03-01', '1970-12-01', '1975-04-01', '1980-08-01', '1982-12-01', '1991-04-01', '2001-12-01', '2009-07-01')

df <-  map_dfr(
  c("GDP", "PRFI", "PNFI", "HCCSDODNS", "USRECM"),
  fredr,
  units = "pc1", # pct from 1 year ago
  frequency = 'q'
) %>%
  select(date, series_id, value) %>%
  pivot_wider(names_from = series_id, values_from= value) %>%
  mutate(
    recessions = as.logical(USRECM),
    Residential_Investment = PRFI,
    NonResidential_Investment = PNFI,
    DurableGoods = HCCSDODNS
  ) %>%
  select(date, recessions, GDP, Residential_Investment, NonResidential_Investment, DurableGoods) %>%
  mutate(crise = case_when(
           (date >= ymd(end[1]) %m+% years(-1) & date <= ymd(end[1]) %m+% years(1)) ~ end[1],
           (date >= ymd(end[2]) %m+% years(-1) & date <= ymd(end[2]) %m+% years(1)) ~ end[2],
           (date >= ymd(end[3]) %m+% years(-1) & date <= ymd(end[3]) %m+% years(1)) ~ end[3],
           (date >= ymd(end[4]) %m+% years(-1) & date <= ymd(end[4]) %m+% years(1)) ~ end[4],
           (date >= ymd(end[5]) %m+% years(-1) & date <= ymd(end[5]) %m+% years(1)) ~ end[5],
           (date >= ymd(end[6]) %m+% years(-1) & date <= ymd(end[6]) %m+% years(1)) ~ end[6],
           (date >= ymd(end[7]) %m+% years(-1) & date <= ymd(end[7]) %m+% years(1)) ~ end[7],
           (date >= ymd(end[8]) %m+% years(-1) & date <= ymd(end[8]) %m+% years(1)) ~ end[8],
           (date >= ymd(end[9]) %m+% years(-1) & date <= ymd(end[9]) %m+% years(1)) ~ end[9],
           (date >= ymd(end[10]) %m+% years(-1) & date <= ymd(end[10]) %m+% years(1)) ~ end[10]
         )) %>%
  mutate(crise = paste0(month(crise),"/",year(crise))) %>%
  mutate(crise = crise %>% as.character() %>% as.factor()) %>%
  pivot_longer(cols = -c(date, crise, recessions), names_to="Series", values_to = "value") %>%
  ## mutate(Series = as.factor(Series)) %>%
  filter(date>=ymd('1981-01-01') & date <=ymd('2011-01-01')) %>%
  drop_na(crise) %>% drop_na()

ggplot(df, aes(x=date, y=value, colour=Series)) +
  geom_line() +
  scale_x_date(breaks = "year", minor_breaks = "6 months", date_labels="%y' %b") +
  ggsci::scale_color_futurama() +
  facet_wrap(~crise, scale="free_x", drop=TRUE) +
  geom_hline(yintercept=0, color='black', size=0.25) +
  xlab("") + ylab("Percent change from 1 year") +
  theme_bw() ->fig

  

for(i in end){
  if(ymd(i) >= ymd('1980-01-01')){
    fig + geom_vline(xintercept = as.numeric(ymd(i)), linetype="dashed",
                color = "black", size=.5) -> fig
  }
}
ggsave(
  "./figs/Centered_End_pct1.png",
  width = 10, height = 8, dpi = 150, units = "in", device = "png"
)
#+end_src

#+RESULTS:
[[file:./figs/Centered_End_pct1.png]]

** Ciclo e tendência

#+BEGIN_SRC python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import pandas_datareader.data as web
from datetime import datetime as dt
import statsmodels.api as sm

start = dt(1979, 1, 1)
end = dt(2020, 12, 31)

df = web.DataReader(["GDPC1", "PRFI"], "fred", start, end)

df.columns = [
    "GDP",
    "Residential Investment",
]
df.index.name = ""
df = df.pct_change().dropna()

cycle, trend = sm.tsa.filters.hpfilter(df["GDP"], 1600)
_cycle, _trend = sm.tsa.filters.hpfilter(df["Residential Investment"], 1600)

df = pd.concat([trend, _trend], axis=1)
df.columns = [
    "GDP",
    "Residential Investment",
]

fig, ax = plt.subplots(1, 1, figsize=(8, 5))

df.plot(ax=ax, color=("black", "darkgrey"))
crise_subprime(ax)
crises(ax)

ax.tick_params(axis="both", which="major", labelsize=15)
ax.legend(fontsize=14)
sns.despine()
plt.xlabel("")
salvar_grafico(file_name="Trend")
plt.close()
#+END_SRC

#+RESULTS:
:results:
:end:

* Residuals :noexport:

#+begin_comment
It is worth mentioning the novelty of \textcite{green_follow_1997} and \textcite{leamer_housing_2007} --- revisited in \textcite{leamer_housing_2015} and by \textcite{fiebiger_trend_2017} --- when shedding light on the relevance of residential investment even before of the Great Recession. CITAÇÃO KEYNES DO PROJETO + DUESEMBERRY



Traditionally, economists do not pay attention to the role of residential investment to macroeconomic dynamics.
There are, nevertheless, two notable exceptions.
In a letter to President Franklin D. Roosevelt, in the mid of the Great Depression, Keynes present the case of housing as the best aid to fight the crisis and to foster economic recovery \cite[p.~436]{keynes_collected_1978}.
The other exception is textcite:duesenberry_investment_1958 who presents a critique of ordinary theories of aggregate investment because they put together firms’ investment in capital and structures and investment in residential housing.
In this sense, he builds a model dedicated for the latter type of investment, emphasizing the role of house prices.

Perhaps, the small share of residential investment on aggregate demand may explain this lack of attention (see figure ref:fig:share).
The subprime crisis and the Great Recession of the US economy had changed the landscape, making clear the macroeconomic role of
housing prices and finance, and residential investment.
Specifically, we argue however small its share on GDP is, it does have a fundamental role in explaining business cycles and long-run growth.
#+end_comment
* Housing Dynamics and Business Cycle in the US Economy :ignore:

Usually, economists did not pay a systematic attention to the role of residential investment to macroeconomic dynamics.
One possible explanation for this could be the small share of residential investment on aggregate demand (see Figure ref:fig:share).
Recently, this lack of attention has been replaced by a better understanding of the macroeconomic relevance of residential investment.
In this Section, we will present some stylized facts regarding the relevance of residential investment for the US economy.

There are, nevertheless, two notable exceptions.
In a letter to President Franklin D. Roosevelt, in the mid of the Great Depression, Keynes presented the case of housing as the best aid to fight the crisis and to foster economic recovery \cite[p.~436]{keynes_collected_1978}.
The other exception is textcite:duesenberry_investment_1958 who critics ordinary theories of aggregate investment because they put firms’ investment in capital and structures together with residential investment.
In this sense, he proposes a model dedicated for the latter type of investment, emphasizing the role of house prices.


#+begin_export latex
\begin{figure}[H]
    \centering
	\caption{Expenditures share on aggregate demand}
	\label{fig:share}
\begin{figure}[htb]
    \includegraphics[width = \textwidth]{./figs/Share_AD.png}
    \end{figure}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' Elaboration}
\end{figure}
#+end_export

After a long time, the interest in residential investment has been restored in the business cycles agenda.
textcite:green_follow_1997 analyzed the connection between residential investment and business cycle even before the Great Recession.
Based on Granger causality tests for the US from 1952 to 1992, he concludes that residential investment leads the business cycle, while non-residential investment lags it.
textcite:green_follow_1997 relates this result to a forward-looking behavior of households.
Thus, he restricts the relevance of residential investment as a temporal precedence indicator.

textcite:leamer_housing_2007 is more incisive and states that housing is the business cycle.
In analyzing the US economy for the post-war period, he concludes that residential investment is the best predictor of economic crises.
The economic cycle of US economy would be a consumer cycle: "first homes, then cars, last business investment" \cite[p.~8]{leamer_housing_2007}.
In a follow up work, the author declares that nine out of eleven US post-war economic recessions were preceded by a severe downturn of residential investment cite:leamer_housing_2015.
# Thus, according to textcite:leamer_housing_2007, residential investment anticipates and causes the business cycle[fn::However, textcite:leamer_housing_2007 him self did not evaluate this statements econometrically.].
textcite:kydland_2016_housing expand \citeauthor*{leamer_housing_2007}'s \citeyear{leamer_housing_2007} proposition to other countries to evaluate how unique the US case is.
Similarly to textcite:green_follow_1997, they also conclude that residential investment leads the business cycle -- while non-residential investment lags it -- for the US and Canada.
The results, however, are more robust when they include housing starts instead of residential investment.
Briefly, they find that housing starts precedes GDP the shorter the time to build is[fn::For the other countries in the sample, textcite:kydland_2016_housing find that residential investment is coincident (and not lagging) with GDP. Additionally, they conclude that long-term nominal mortgage rate is a relevant transmission channel from interest rates to housing costs.].
Similarly, textcite:huang_is_2018 assess  prediction and causality relations proposed by textcite:leamer_housing_2007 for 17 OECD countries.
For the US both statements are valid and housing related variables (house prices, real mortgage rate and bank spread) lead the business cycle[fn::For the other countries, they found inconclusive results regarding fluctuations due to institutional heterogeneity. However, textcite:huang_is_2018 claim that for most G7 countries, residential investment at least amplify the business cycle.].


In order to depict the relation between residential investment and business cycle, we present Figure ref:fig:cycle.
In each panel, we present the growth rate of selected expenditures two years before and two years after recession starts.
In most of them, residential investment growth rate is negative before the recession start.
The Great Recession is a remarkable example of this pattern while dot-com crisis (2000-1) is an exception as already pointed out by textcite:leamer_housing_2007.


#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Selected expenditures growth rates two years before and two years after recession starts\\Dashed lines indicates recession start (NBER recession dating procedure)}
	\label{fig:cycle}
	\includegraphics[width=\textwidth]{./figs/Centered_Begin_pct1.png}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' Elaboration}
\end{figure}
#+end_export

#+begin_comment
Talvez discutir preço aqui
#+end_comment


In a heterodox perspective, textcites:fiebiger_semi-autonomous_2018,fiebiger_trend_2017 present residential investment as a Luxemburg-type external market providing a source of autonomous demand to absorb economic surplus.
Both works state its role (together with debt-financed consumption) in inducing non-residential investment and driving output growth, during the business cycle as well in the long-run.
Figure ref:fig:trend presents the trend of GDP and residential investment growth rate by estimating a HP filter[fn::It worth noting that Figure ref:fig:trend is just a visualization procedure. We are aware of the econometric problems regarding this type of filter. For details see textcite:NBER_HP].
Both series share a correlational relation in which residential investment growth rate is more volatile than GDP growth rate.
Recently, textcite:perez_Montiel_2021 find that residential investment leads both the business cycles and the long-run economic growth for the US economy.
Similar to textcite:girardi_long-run_2016, they do not report any relevant feedback from output to residential investment, categorizing this expenditure as autonomous.

#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{GDP and Residential investment growth rate tred (HP filter, $\lambda = 1600$)}
	\label{fig:trend}
	\includegraphics[width=\textwidth]{./figs/Trend.png}
	\caption*{\textbf{Source:} Authors' Elaboration}
\end{figure}
#+end_export


Before we move forward, it is worth mentioning that the relevance of housing is not restricted to its implications to growth and business cycles.
For example, textcite:jorda_great_2016 report that credit and financial sector growth has been led mainly by mortgages. 
As a consequence, banking activities were redirected towards granting credit majorly to households and not towards non-residential investment cites:erturk_banks_2007,kohl_more_2018.
Other studies have shown that house price inflation is the main determinant of household indebtedness, distribution of wealth and that it has implications for macroeconomic stability cites:ryoo_household_2015,stockhammer_debt-driven_2016,barnes_private_2016,johnston_global_2017,mian_household_2017,anderson_politics_2020,fuller_housing_2020.
In summary, what we intended to show was the macroeconomic relevance of residential investment.
On the following section, we analyze how econometric literature has dealt with its determinants.

*** TODO Falar sobre bolha no parágrafo anterior? :noexport:
