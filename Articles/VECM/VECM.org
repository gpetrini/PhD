* Configs and codes :noexport:
#+PROPERTY: header-args:python :results output drawer replace :session *VECM* :exports none :tangle ./code/VECM.py :eval never-export

bibliography:ref.bib

** Loading packages
#+BEGIN_SRC python
from PIL import Image  # for grey scale
from datetime import datetime as dt

t1 = dt.now()

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.api as sm
import matplotlib.ticker as plticker

import pandas_datareader.data as web

from scipy.interpolate import make_interp_spline, BSpline  # Smooth plot


sns.set(style="whitegrid")
# sns.set_context("paper")

plt.rc("axes", titlesize=25)  # fontsize of the axes title
plt.rcParams.update({"font.size": 20})
plt.rc("legend", fontsize=14)  # legend fontsize
plt.rc("axes", labelsize=22)  # fontsize of the x and y labels
#+END_SRC

#+RESULTS:
:results:
:end:

** Save plot

#+BEGIN_SRC python
def salvar_grafico(file_name, extension="png", pasta="./figs/"):
    fig.savefig(pasta + file_name + '.' + extension, dpi = 600, bbox_inches = 'tight', format=extension,
    pad_inches = 0.2, transparent = False,)
#+END_SRC

#+RESULTS:
:results:
:end:

** Plots
*** Own houses rate of interest

#+BEGIN_SRC python :results graphics file :file ./figs/TxPropria_Investo.png
start = dt(1987, 1, 1)
end = dt(2019, 10, 1)

df = web.DataReader(
    ["PRFI", "CSUSHPISA", "MORTGAGE30US", "CPIAUCSL"], "fred", start, end
)

df.columns = ["Residential Investment", "House Prices", "Interest rate", "Prices"]
df.index.name = ""


df["Interest rate"] = df["Interest rate"].divide(100)
df = df.resample("M").last()

df["House Prices"] = df["House Prices"] / df["House Prices"][0]
df = df.resample("Q").last()
df["Inflation"] = df["House Prices"].pct_change()
df["General inflation"] = df["Prices"].pct_change()
df["Houses own rate of interest"] = ((1 + df["Interest rate"]) / (1 + df["Inflation"])) - 1
df["Real mortgages interest rate"] = (
    (1 + df["Interest rate"]) / (1 + df["General inflation"])
) - 1

df["$g_{I_h}$"] = df["Residential Investment"].pct_change()


fig, ax = plt.subplots(figsize=(19.2, 10.8))

df[
    [
        # 'Real mortgages interest rate',
        "Houses own rate of interest",
        "$g_{I_h}$",
    ]
].plot(ax=ax, lw=3, color=("black", "gray"))

ax.tick_params(axis="both", which="major", labelsize=15)
sns.despine()
salvar_grafico("TxPropria_Investo")
plt.close("all")
#+END_SRC

#+RESULTS:
[[file:./figs/TxPropria_Investo.png]]

*** textcite:yeo_new_2000 transformation

#+BEGIN_SRC python :results graphics file :file ./figs/YeoJohnson_All.png
df = pd.read_csv("./data/Data_yeojohnson.csv", index_col=[0], parse_dates=True)

df = df[["Interest rate", "Inflation", "gIh", "Own Interest rate"]]
df.columns = [  # Renaming
    "Mortgage interest rate",
    "House price inflation",
    "Residential investment growth rate",
    "Houses own rate of interest",
]

fig, ax = plt.subplots(2, 2, figsize=(19.2, 10.8), sharey=True)

for i, ax in enumerate(ax.flat):
    df[[df.columns[i]]].plot(ax=ax, lw=3, color="black", legend=False)
    ax.set_title(df.columns[i])
    ax.tick_params(axis="both", which="major", labelsize=15)
    sns.despine()

plt.tight_layout()

salvar_grafico("YeoJohnson_All")
plt.close("all")
#+END_SRC

#+RESULTS:
[[file:./figs/YeoJohnson_All.png]]

*** Construction 
**** Download
#+begin_src shell 
cd /HDD/PhD/Articles/VECM/data/

wget https://www.census.gov/construction/nrc/xls/avg_authtostart_cust.xls
mv avg_authtostart_cust.xls construcao_autorizacao.xls

wget https://www.census.gov/construction/nrc/xls/avg_starttocomp_cust.xls
mv avg_starttocomp_cust.xls construcao_tempo.xls
cd /HDD/PhD/Articles/VECM/
#+end_src

#+RESULTS:

**** Plot
#+BEGIN_SRC python :results graphics file :file ./figs/Meses_contrucao.png
df_autorizacao = pd.read_excel(
    "./data/construcao_autorizacao.xls",
    skiprows=11,
    index_col=[0],
    parse_dates=True,
    na_values="(NA)",
)
df_autorizacao.index.name = "Ano"
df_autorizacao.columns = [
    "Total",
    "Venda",
    "Contratado",
    "Proprietário",
    "Total (2 ou mais unidade)",
    "2 a 4",
    "5 a 9",
    "10 a 19",
    "20 ou mais",
]
df_autorizacao = df_autorizacao[
    [
        "Total",
        "Venda",
        "Contratado",
        "Proprietário",
    ]
]


df_autorizacao = df_autorizacao.apply(pd.to_numeric, errors="ignore")
numero_linhas = int((dt(2020, 1, 1) - dt(1976, 1, 1)).days / 365.25 + 1)
df_autorizacao = df_autorizacao.iloc[:numero_linhas, :]

df_start = pd.read_excel(
    "./data/construction.xls", skiprows=11, index_col=[0], parse_dates=True
)
df_start.index.name = "Ano"
df_start.columns = [
    "Total",
    "Venda",
    "Contratado",
    "Proprietário",
    "Total (2 ou mais unidade)",
    "2 a 4",
    "5 a 9",
    "10 a 19",
    "20 ou mais",
]

df_start = df_start[
    [
        "Total",
        "Venda",
        "Contratado",
        "Proprietário",
    ]
]
numero_linhas = int((dt(2020, 1, 1) - dt(1971, 1, 1)).days / 365.25 + 1)
df_start = df_start.iloc[:numero_linhas, :]
df_start = df_start.apply(pd.to_numeric, errors="coerce")
df = df_autorizacao + df_start
# df = df.dropna()


fig, ax = plt.subplots(figsize=(19.2, 10.8))

sns.kdeplot(df["Total"], shade=True, color="darkred", ax=ax, label="Mean")
sns.kdeplot(df["Venda"], shade=True, color="darkgreen", ax=ax, label="For Sale")
sns.kdeplot(df["Contratado"], shade=True, color="orange", ax=ax, label="By contract")
sns.kdeplot(df["Proprietário"], shade=True, color="purple", ax=ax, label="By the owner")

# ax.xaxis.set_ticks(np.arange(0, 16, 3))
loc = plticker.MultipleLocator(base=3.0)  # this locator puts ticks at regular intervals
ax.xaxis.set_major_locator(loc)


ax.tick_params(axis="both", which="major", labelsize=15)
ax.set_xlabel("Months")
ax.set_ylabel("Probability density")

# ax.legend(loc='center left', bbox_to_anchor=(1, 0.5))
ax.legend(fontsize=14)

ax.tick_params(axis="both", which="major", labelsize=15)
sns.despine()
plt.tight_layout()
salvar_grafico("Meses_construcao")
plt.close("all")

c_total = df["Total"].mean()
c_venda = df["Venda"].mean()
c_contrato = df["Contratado"].mean()
c_proprietario = df["Proprietário"].mean()
#+END_SRC

#+RESULTS:
[[file:./figs/Meses_contrucao.png]]

*** Cycles

#+BEGIN_SRC python :results graphics file :file ./figs/Ciclo_Ih_u.png
start = dt(1951, 12, 1)
end = dt(2019, 1, 1)
df = web.DataReader(
    [
        'GDP',
        'PRFI',
        'PNFI',
        'TCU',
        'PCDG',
    ], 
    'fred', 
    start, end
)

df.columns = [
    "GDP",
    "Residential investment",
    "Non-residential investment",
    "Capacity utilization",
    "Duráveis"
]

df['Capacity utilization'] = df['Capacity utilization']/100
df['Ih/GDP'] = df['Residential investment']/df['GDP']
df['If/GDP'] = df['Non-residential investment']/df['GDP']
df['Duráveis/GDP'] = df['Duráveis']/df['GDP']
df['Ano'] = df.index.year
df = df.resample('Q').last()
df['gY'] = df['GDP'].pct_change(4)

df.index.name = ''
df = df.dropna()

sns.set_context('talk')
fig, ax = plt.subplots(2,
                       3,
                       sharex=True,
                       sharey=True,
                       squeeze=False,
                       figsize=(19.2, 10.8))

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["1970-12":"1975-01"],
                ax=ax[0, 0],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["1970-12":"1975-01"],
             ax=ax[0, 0],
             sort=False,
             color='black',
             lw=4,
            )
ax[0, 0].set_title("1970 (IV) - 1975 (I)", fontsize=18)

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["1975-01":"1980-10"],
                ax=ax[0, 1],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["1975-01":"1980-10"],
             ax=ax[0, 1],
             sort=False,
             color='black',
             lw=4,)
ax[0, 1].set_title("1975 (I) - 1980 (III)", fontsize=18)

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["1980-10":"1982-12"],
                ax=ax[0, 2],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["1980-10":"1982-12"],
             ax=ax[0, 2],
             sort=False,
             color='black',
             lw=4,)
ax[0, 2].set_title("1980 (III) - 1982 (IV)", fontsize=18)

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["1982-12":"1991-01"],
                ax=ax[1, 0],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["1982-12":"1991-01"],
             ax=ax[1, 0],
             sort=False,
             color='black',
             lw=4,)
ax[1, 0].set_title("1982 (IV) - 1991 (I)")

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["1991-01":"2001-12"],
                ax=ax[1, 1],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["1991-01":"2001-12"],
             ax=ax[1, 1],
             sort=False,
             color='black',
             lw=4,)
ax[1, 1].set_title("1991 (I) - 2001 (IV)", fontsize=18)

sns.scatterplot(y='Ih/GDP',
                x='Capacity utilization',
                data=df["2001-12":"2009-07"],
                ax=ax[1, 2],
                size='Ano',
                sizes=(5, 300),
                color='black',
                legend=False)
sns.lineplot(y='Ih/GDP',
             x='Capacity utilization',
             data=df["2001-12":"2009-07"],
             ax=ax[1, 2],
             sort=False,
             color='black',
             lw=4,)
ax[1, 2].set_title("2001 (IV) - 2009 (II)", fontsize=18)

sns.despine()
ax[0, 0].set_ylabel("")
ax[1, 0].set_xlabel('')
ax[1, 0].set_ylabel("")
ax[1, 1].set_xlabel('')
ax[1, 2].set_xlabel('')

fig.tight_layout(rect=[0, 0.03, 1, 0.90])
fig.text(0.5,
         0.03,
         'Capacity utilization (Total industry)',
         ha='center',
         fontsize=20)
fig.text(-0.01,
         0.5,
         'Residential investment/GDP',
         va='center',
         rotation='vertical',
         fontsize=20)
plt.suptitle(
    "(Markers sizes increases over time)"
)

salvar_grafico(file_name="Ciclo_Ih_u")
plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/Ciclo_Ih_u.png]]


** Model related 
#+BEGIN_SRC python
from statsmodels.tsa.vector_ar.var_model import VAR
from statsmodels.tsa.api import SVAR
from statsmodels.tsa.vector_ar.vecm import coint_johansen, CointRankResults, VECM, select_coint_rank

from statsmodels.stats.diagnostic import acorr_breusch_godfrey, acorr_ljungbox, het_arch, het_breuschpagan, het_white
from statsmodels.tsa.stattools import adfuller, kpss, grangercausalitytests, q_stat, coint
from arch.unitroot import PhillipsPerron, ZivotAndrews, DFGLS, KPSS, ADF

from statsmodels.graphics.tsaplots import plot_acf, plot_pacf


import pandas_datareader.data as web
from scipy.stats import yeojohnson

start = dt(1987, 1, 1)
end = dt(2019, 7, 1)
#+END_SRC

#+RESULTS:
:results:
:end:

** Loading data

#+BEGIN_SRC python
df = web.DataReader(
    [
        "PRFI",
        "CSUSHPISA",
        "MORTGAGE30US",
    ], 
    'fred', 
    start, 
    end
)

df.columns = [
    "Residential Investment", 
    "House Prices", 
    "Interest rate",
]
df.index.name = ""

df['Interest rate'] = df['Interest rate'].divide(100)
df = df.resample('M').last()
df['House Prices'] = df['House Prices']/df['House Prices'][0]
df = df.resample('Q').last()

df["Inflation"] = df["House Prices"].pct_change() # Warning: 4
df['gIh'] = df["Residential Investment"].pct_change() # Warning: 4
df["Own Interest rate"] = ((1+df["Interest rate"])/(1+df["Inflation"])) -1

df['Own Interest rate'], *_ = yeojohnson(df['Own Interest rate'])
#df['Inflation'], *_ = yeojohnson(df['Inflation'])
df['gIh'], *_ = yeojohnson(df['gIh'])

df[["Inflation", "gIh", "Own Interest rate", "Interest rate"]].to_csv("./data/Complete_Data")

df["Crisis"] = [0 for i in range(len(df["gIh"]))]
for i in range(len(df["Crisis"])):
    if df.index[i] > dt(2007,12,1) and df.index[i] < dt(2009,7,1):
        df["Crisis"][i] = 1

df = df[["Interest rate", "Inflation", "gIh", "Crisis", "Own Interest rate"]]

df["d_Own Interest rate"] = df["Own Interest rate"].diff()
df["d_gIh"] = df["gIh"].diff()
df["d_Inflation"] = df["Inflation"].diff()
df["d_Interest rate"] = df['Interest rate'].diff()
df = df.dropna()
#+END_SRC

#+RESULTS:
:results:
/home/gpetrini/.local/lib/python3.8/site-packages/scipy/stats/morestats.py:1371: RuntimeWarning: invalid value encountered in greater_equal
  pos = x >= 0  # binary mask
/tmp/babel-vntgsk/python-m5dFpb:37: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df["Crisis"][i] = 1
:end:

** Functions
*** Unit root test
#+BEGIN_SRC python
def testes_raiz(df=df["gIh"], original_trend='c', diff_trend='c'):
    """
    serie: Nome da coluna do df
    orignal_trend: 'c', 'ct', 'ctt'
    diff_trend: 'c', 'ct', 'ctt'
    
    Plota série o original e em diferenta e retorna testes de raíz unitária
    """
    fig, ax = plt.subplots(1,2)

    df.plot(ax=ax[0], title='Original series')
    df.diff().plot(ax=ax[1], title='First differences')

    plt.tight_layout()
    sns.despine()
    plt.close('all')
    
    fig, ax = plt.subplots(2,2)
    
    plot_acf(df, ax=ax[0,0], title='ACF: serie original') 
    plot_pacf(df, ax=ax[0,1], title='PACF: serie original')
    
    plot_acf(df.diff().dropna(), ax=ax[1,0], title='ACF: serie em diferença') 
    plot_pacf(df.diff().dropna(), ax=ax[1,1], title='PACF: serie em diferença')
    
    plt.tight_layout()
    sns.despine() 
    plt.close('all')

    
    # Zivot Andrews
    print('\nZIVOT ANDREWS level series')
    print(ZivotAndrews(df, trend = original_trend).summary(),"\n")
    print('\nZIVOT ANDREWS First differences')
    print(ZivotAndrews(df.diff().dropna(), trend = diff_trend).summary(),"\n")
    
    print('\nADF level series')
    print(ADF(df, trend=original_trend).summary(),"\n")
    print('\nADF First differences')
    print(ADF(df.diff().dropna(), trend=diff_trend).summary(),"\n")
    
    print('\nDFGLS level series')
    print(DFGLS(df, trend=original_trend).summary(),"\n")
    print('\nDFGLS First differences')
    print(DFGLS(df.diff().dropna(), trend=diff_trend).summary(),"\n")
    
    print('\nKPSS em nível')
    print(KPSS(df, trend = original_trend).summary(),"\n")
    print('\nKPSS em primeira diferença')
    print(KPSS(df.diff().dropna(), trend = diff_trend).summary(),"\n")
    
    print('\nPhillips Perron em nível')
    print(PhillipsPerron(df, trend=original_trend).summary(),"\n")
    print('\nPhillips Perron em primeira diferença')
    print(PhillipsPerron(df.diff().dropna(), trend=diff_trend).summary(),"\n")
#+END_SRC

#+RESULTS:
:results:
:end:


*** Engel-Granger and Johansen conintegration test


#+BEGIN_SRC python
# Teste de cointegração

def cointegracao(ts0, ts1, signif = 0.05, lag=1):
  trends = ['nc', 'c', 'ct', 'ctt']
  for trend in trends:
    print(f"\nTestando para lag = {lag} e trend = {trend}")
    result = coint(ts0, ts1, trend = trend, maxlag=lag)
    print('Null Hypothesis: there is NO cointegration')
    print('Alternative Hypothesis: there IS cointegration')
    print('t Statistic: %f' % result[0])
    print('p-value: %f' % result[1])
    if result[1] < signif:
      print('CONCLUSION: REJECT null Hypothesis: there IS cointegration\n')
    else:
      print('CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration\n')
    
def testes_coint(series, maxlag=6, signif = 0.05,):
    for i in range(1, maxlag):
        print(50*'=')
        cointegracao(
            ts0=series.iloc[:, 0],
            ts1=series.iloc[:, 1:],
            signif=signif,
            lag=i
        )
        print("\nTESTE DE JOHANSEN\n")
        print("Teste SEM constante")
        result = select_coint_rank(endog=series, k_ar_diff=i, det_order=-1, signif=signif) ## Warning: 1
        print(result.summary())
        print(f'Para lag = {i} e significância = {signif*100}%, Rank = {result.rank}')
        print("\nTeste COM constante\n")
        result = select_coint_rank(endog=series, k_ar_diff=i, det_order=0, signif=signif) ## Warning: 1
        print(result.summary())
        print(f'Para lag = {i} e significância = {signif*100}%, Rank = {result.rank}')
        print("\nTeste COM constante E tendência\n")
        result = select_coint_rank(endog=series, k_ar_diff=i, det_order=1, signif=signif) ## Warning: 1
        print(result.summary())
        print(f'Para lag = {i} e significância = {signif*100}%, Rank = {result.rank}')
        print(10*'=')
#+END_SRC

#+RESULTS:
:results:
:end:

*** Residuals analysis: Ljung-Box and Box-Pierce

#+BEGIN_SRC python
### Resíduos

def LjungBox_Pierce(resid, signif = 0.05, boxpierce = False, k = 4):
  """
  resid = residuals df
  signif = signif. level
  """
  var = len(resid.columns)
  print("H0: autocorrelations up to lag k equal zero")
  print('H1: autocorrelations up to lag k not zero')
  print("Box-Pierce: ", boxpierce)
  
  for i in range(var):
    print("Testing for ", resid.columns[i].upper(), ". Considering a significance level of",  signif*100,"%")
    result = acorr_ljungbox(x = resid.iloc[:,i-1], lags = k, boxpierce = boxpierce)[i-1]
    conclusion = result < signif
    for j in range(k):
      print(f'p-value = {result[j]}')
      print("Reject H0 on lag " ,j+1,"? ", conclusion[j], "\n")
    print("\n")
    
def ARCH_LM(resid, signif = 0.05, autolag = 'bic'):
  """
  df = residuals df
  signif = signif. level
  """
  var = len(resid.columns)
  print("H0: Residuals are homoscedastic")
  print('H1: Residuals are heteroskedastic')
  
  for i in range(var):
    print("Testing for ", resid.columns[i].upper())
    result = het_arch(resid = resid.iloc[:,i], autolag = autolag)
    print('LM statistic: ', result[0])
    print('LM p-value: ', result[1])
    print("Reject H0? ", result[1] < signif)
    print('F statistic: ', result[2])
    print('F p-value: ', result[3])
    print("Reject H0? ", result[3] < signif)
    print('\n')
    

def analise_residuos(results, nmax=15):
    
    residuals = pd.DataFrame(results.resid, columns = results.names)
    
    residuals.plot()
    sns.despine()
    
    plt.close('all')
    
    for serie in residuals.columns:
        sns.set_context('talk')
        fig, ax = plt.subplots(1,2, figsize=(10,8))

        plot_acf(residuals[serie], ax=ax[0], title=f'ACF Resíduo de {serie}', zero=False) 
        plot_pacf(residuals[serie], ax=ax[1], title=f'PACF Resíduo de {serie}', zero=False)
        
        plt.tight_layout()
        sns.despine() 
        
        plt.close('all')

    print('AUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU\n')
    print(results.test_whiteness(nlags=nmax).summary())
    print('\nAUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU AJUSTADO\n')
    print(results.test_whiteness(nlags=nmax, adjusted=True).summary())
    print('\nLJUNGBOX\n')
    LjungBox_Pierce(residuals, k = 12, boxpierce=False)
    print('\nBOXPIERCE\n')
    LjungBox_Pierce(residuals, k = 12, boxpierce=True)
    print('\nNORMALIDADE\n')
    print(results.test_normality().summary())
    print('\nHOMOCEDASTICIDADE\n')
    ARCH_LM(residuals)
    
    return residuals
results = []
def plot_lags(results = results, trimestres=[2, 5]):
    series = results.names
    sns.set_context('talk')
    fig, ax = plt.subplots(len(trimestres),2, figsize = (16,10))
    
    for i in range(len(trimestres)):
        sns.regplot(y = df[series[0]], x = df[series[1]].shift(-trimestres[i]), color = 'black', ax = ax[i,0], order = 2)
        ax[i,0].set_xlabel(f'{series[1]} lagged in {trimestres[i]} quarters')

        sns.regplot(x = df[series[0]].shift(-trimestres[i]), y = df[series[1]], color = 'black', ax = ax[i,1], order = 2)
        ax[i,1].set_xlabel(f'{series[0]} lagged in {trimestres[i]} quarters')
        
    plt.tight_layout()
    plt.close('all')
    
    return fig
#+END_SRC

#+RESULTS:
:results:
:end:


*** FEVD for VECM

#+BEGIN_SRC python
from statsmodels.compat.python import lrange, iteritems
from statsmodels.tsa.vector_ar import output, plotting, util


def fmse(self, steps):
    r"""
    Compute theoretical forecast error variance matrices

    Parameters
    ----------
    steps : int
        Number of steps ahead

    Notes
    -----
    .. math:: \mathrm{MSE}(h) = \sum_{i=0}^{h-1} \Phi \Sigma_u \Phi^T

    Returns
    -------
    forc_covs : ndarray (steps x neqs x neqs)
    """
    ma_coefs = self.ma_rep(steps)

    k = len(self.sigma_u)
    forc_covs = np.zeros((steps, k, k))

    prior = np.zeros((k, k))
    for h in range(steps):
        # Sigma(h) = Sigma(h-1) + Phi Sig_u Phi'
        phi = ma_coefs[h]
        var = phi @ self.sigma_u @ phi.T
        forc_covs[h] = prior = prior + var

    return forc_covs


class FEVD(object):
    """
    Compute and plot Forecast error variance decomposition and asymptotic
    standard errors
    """

    def __init__(self, model, P=None, periods=None):

        self.periods = periods

        self.model = model
        self.neqs = model.neqs
        self.names = model.model.endog_names

        self.irfobj = model.irf(periods=periods)
        self.orth_irfs = self.irfobj.orth_irfs

        # cumulative impulse responses
        irfs = (self.orth_irfs[:periods] ** 2).cumsum(axis=0)

        rng = lrange(self.neqs)
        mse = fmse(self.model, periods)[:, rng, rng]

        # lag x equation x component
        fevd = np.empty_like(irfs)

        for i in range(periods):
            fevd[i] = (irfs[i].T / mse[i]).T

        # switch to equation x lag x component
        self.decomp = fevd.swapaxes(0, 1)

    def summary(self):
        buf = StringIO()

        rng = lrange(self.periods)
        for i in range(self.neqs):
            ppm = output.pprint_matrix(self.decomp[i], rng, self.names)

            buf.write("FEVD for %s\n" % self.names[i])
            buf.write(ppm + "\n")

        print(buf.getvalue())

    def plot(self, periods=None, figsize=(16, 5), **plot_kwds):
        """Plot graphical display of FEVD

        Parameters
        ----------
        periods : int, default None
            Defaults to number originally specified. Can be at most that number
        """
        import matplotlib.pyplot as plt

        k = self.neqs
        periods = periods or self.periods

        fig, axes = plt.subplots(nrows=k, figsize=figsize)
        fig, axes = plt.subplots(1, 2, figsize=figsize, sharey=True)

        # fig.suptitle('Forecast error variance decomposition (FEVD)')

        colors = ["black", "lightgray"]
        ticks = np.arange(periods)

        limits = self.decomp.cumsum(2)

        for i in range(k):
            ax = axes[i]

            this_limits = limits[i].T

            handles = []

            for j in range(k):
                lower = this_limits[j - 1] if j > 0 else 0
                upper = this_limits[j]
                handle = ax.bar(
                    ticks,
                    upper - lower,
                    bottom=lower,
                    color=colors[j],
                    label=self.names[j],
                    ,**plot_kwds
                )

                handles.append(handle)
            ax.axhline(y=0.5, color="white", ls="--", lw=3) # more printer friendly

            ax.set_title(self.names[i])

        # just use the last axis to get handles for plotting
        handles, labels = ax.get_legend_handles_labels()
        ax.legend(loc='center left', bbox_to_anchor=(1, 0.5))
        # fig.legend(handles, labels, loc="lower right")
        # plotting.adjust_subplots(right=0.85)
        sns.despine()
        return fig
#+END_SRC

#+RESULTS:
:results:
:end:

*** Structural break test

#+begin_src ess-r :eval no :tangle ./code/strucchange.R
library(strucchange)
library(urca)
library(dplyr)

df <- read.csv(
  "./data/Complete_Data.csv",
  encoding="UTF-8", 
  stringsAsFactors=FALSE
  )
df <- ts(data = df, start = c(1987,01), frequency = 4)
df <- zoo::na.locf0(df)
colnames(df) <- c("X", "Infla", "gIh", "Own", "Interest rate")

## Taxa de crescimento do Residential investment


result = breakpoints(gIh~1, data=df)
result$breakpoints %>% unique() %>% na.omit() %>% c() -> breaks

for(i in breaks){
  print(paste0("Testando para i = ", index(df)[i]))
  strucchange::sctest(gIh~1, data=df, point=i, type="Chow") %>% print()
}


## Own Interest rate


result = breakpoints(Own~1, data=df)
result$breakpoints %>% unique() %>% na.omit() %>% c() -> breaks

for(i in breaks){
  print(paste0("Testando para i = ", index(df)[i]))
  strucchange::sctest(Own~1, data=df, point=i, type="Chow") %>% print()
}


## Interest rate


result = breakpoints(Interest rate~1, data=df)
result$breakpoints %>% unique() %>% na.omit() %>% c() -> breaks

for(i in breaks){
  print(paste0("Testando para i = ", index(df)[i]))
  strucchange::sctest(Interest rate~1, data=df, point=i, type="Chow") %>% print()
}


## Inflation


result = breakpoints(Infla~1, data=df)
result$breakpoints %>% unique() %>% na.omit() %>% c() -> breaks

for(i in breaks){
  print(paste0("Testando para i = ", index(df)[i]))
  strucchange::sctest(Infla~1, data=df, point=i, type="Chow") %>% print()
}
#+end_src

** Subseting

#+BEGIN_SRC python
df = df["1992-01-01":]
df[["Inflation", "gIh", "Own Interest rate", "Interest rate"]].to_csv(
    "../data/Data_yeojohnson.csv"
)


df[["Inflation", "gIh", "Own Interest rate", "Interest rate"]].to_csv(
    "../data/Data_yeojohnson_ascii.csv",
    encoding="ascii",
    header=[
        "infla",
        "gIh",
        "Own",
        "Interest rate",
    ],
)
df = df.dropna()
#+END_SRC

#+RESULTS:
:results:
:end:

** Unit root test 

*** Housing growth rate

#+BEGIN_SRC python
testes_raiz(df=df['gIh'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                 -4.461
P-value                         0.132
Lags                               11
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -7.793
P-value                         0.000
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -3.342
P-value                         0.013
Lags                               11
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -7.204
P-value                         0.000
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -1.325
P-value                         0.177
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -0.967
P-value                         0.306
Lags                               10
-------------------------------------

Trend: Constant
Critical Values: -2.76 (1%), -2.14 (5%), -1.83 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.178
P-value                         0.315
Lags                                5
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.097
P-value                         0.601
Lags                               21
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -6.136
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -20.273
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

*** Own rate of interest

#+BEGIN_SRC python
testes_raiz(df['Own Interest rate'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                 -4.224
P-value                         0.227
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.353
P-value                         0.000
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -2.315
P-value                         0.167
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -5.104
P-value                         0.000
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -1.032
P-value                         0.280
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -2.74 (1%), -2.12 (5%), -1.81 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -3.771
P-value                         0.000
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.691
P-value                         0.014
Lags                                6
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.060
P-value                         0.814
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -2.409
P-value                         0.139
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -10.387
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

*** Inflation

#+BEGIN_SRC python
testes_raiz(df['Inflation'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                 -4.896
P-value                         0.040
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.155
P-value                         0.001
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -2.671
P-value                         0.079
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -4.715
P-value                         0.000
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -2.530
P-value                         0.012
Lags                                4
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -3.954
P-value                         0.000
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.148
P-value                         0.395
Lags                                5
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.058
P-value                         0.825
Lags                                6
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -2.699
P-value                         0.074
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -11.335
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

*** Mortgage interest rate

#+BEGIN_SRC python
testes_raiz(df['Interest rate'], original_trend='ct')
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                 -4.494
P-value                         0.215
Lags                                0
-------------------------------------

Trend: Constant and Linear Time Trend
Critical Values: -5.58 (1%), -5.07 (5%), -4.83 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -8.144
P-value                         0.000
Lags                                1
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -3.638
P-value                         0.027
Lags                                0
-------------------------------------

Trend: Constant and Linear Time Trend
Critical Values: -4.04 (1%), -3.45 (5%), -3.15 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -8.050
P-value                         0.000
Lags                                1
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -3.445
P-value                         0.009
Lags                                0
-------------------------------------

Trend: Constant and Linear Time Trend
Critical Values: -3.60 (1%), -3.02 (5%), -2.73 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -1.074
P-value                         0.264
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -2.76 (1%), -2.14 (5%), -1.83 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.081
P-value                         0.264
Lags                                5
-------------------------------------

Trend: Constant and Linear Time Trend
Critical Values: 0.22 (1%), 0.15 (5%), 0.12 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.034
P-value                         0.962
Lags                                3
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -3.604
P-value                         0.030
Lags                               13
-------------------------------------

Trend: Constant and Linear Time Trend
Critical Values: -4.04 (1%), -3.45 (5%), -3.15 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -11.127
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

** Cointegration

*** $g_{I_{h}}$ and own rate of interest




#+BEGIN_SRC python
print("VAR Order\n")

model = VAR(
    df[["gIh", 'Own Interest rate']])
print(model.select_order(maxlags=15, trend='ct').summary())

testes_coint(series=df[['gIh', 'Own Interest rate']], maxlag=9)
#+END_SRC

#+RESULTS:
:results:
VAR Order

 VAR Order Selection (* highlights the minimums)
==================================================
       AIC         BIC         FPE         HQIC
--------------------------------------------------
0       -14.83      -14.72   3.633e-07      -14.78
1       -16.33     -16.12*   8.089e-08      -16.24
2       -16.30      -15.98   8.328e-08      -16.17
3       -16.42      -15.99   7.378e-08      -16.25
4       -16.47      -15.93   7.067e-08      -16.25
5      -16.57*      -15.93  6.380e-08*     -16.31*
6       -16.50      -15.75   6.824e-08      -16.20
7       -16.46      -15.60   7.156e-08      -16.11
8       -16.40      -15.43   7.637e-08      -16.01
9       -16.40      -15.33   7.633e-08      -15.97
10      -16.34      -15.15   8.172e-08      -15.86
11      -16.33      -15.04   8.297e-08      -15.81
12      -16.55      -15.15   6.672e-08      -15.99
13      -16.49      -14.99   7.134e-08      -15.88
14      -16.48      -14.86   7.315e-08      -15.82
15      -16.43      -14.71   7.743e-08      -15.73
--------------------------------------------------
==================================================

Testando para lag = 1 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.167538
p-value: 0.016920
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -4.364738
p-value: 0.002025
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.114267
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          13.18          12.32
  1   2          3.029          4.130
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          23.54          15.49
  1   2          5.117          3.841
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          48.48          18.40
  1   2          6.035          3.841
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 2 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.430656
p-value: 0.106277
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 2 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.819589
p-value: 0.159531
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 2 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -4.400628
p-value: 0.007870
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 2 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          12.63          12.32
  1   2          3.031          4.130
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          15.58          15.49
  1   2          4.512          3.841
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          26.12          18.40
  1   2          6.681          3.841
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 3 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.829801
p-value: 0.042218
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 3 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.819589
p-value: 0.159531
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 3 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -4.400628
p-value: 0.007870
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 3 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          17.19          12.32
  1   2          2.506          4.130
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          20.94          15.49
  1   2          3.940          3.841
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          33.41          18.40
  1   2          7.565          3.841
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 4 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.243920
p-value: 0.154185
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 4 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.164779
p-value: 0.442594
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 4 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.127549
p-value: 0.211978
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 4 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          18.69          12.32
  1   2          2.381          4.130
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          19.04          15.49
  1   2          3.716          3.841
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 1

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          27.89          18.40
  1   2          13.26          3.841
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 5 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.243920
p-value: 0.154185
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 5 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.164779
p-value: 0.442594
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 5 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.127549
p-value: 0.211978
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 5 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          15.46          12.32
  1   2          2.643          4.130
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          14.67          15.49
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 0

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          21.17          18.40
  1   2          9.596          3.841
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 6 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.243920
p-value: 0.154185
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 6 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.164779
p-value: 0.442594
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 6 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.213828
p-value: 0.673250
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 6 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -9.988571
p-value: 0.000000
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          13.56          12.32
  1   2          2.454          4.130
-------------------------------------
Para lag = 6 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          11.85          15.49
-------------------------------------
Para lag = 6 e significância = 5.0%, Rank = 0

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          17.36          18.40
-------------------------------------
Para lag = 6 e significância = 5.0%, Rank = 0
==========
==================================================

Testando para lag = 7 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.243920
p-value: 0.154185
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 7 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.164779
p-value: 0.442594
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 7 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.127549
p-value: 0.211978
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 7 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.516636
p-value: 0.209095
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          15.34          12.32
  1   2          3.352          4.130
-------------------------------------
Para lag = 7 e significância = 5.0%, Rank = 1

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          13.83          15.49
-------------------------------------
Para lag = 7 e significância = 5.0%, Rank = 0

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          17.53          18.40
-------------------------------------
Para lag = 7 e significância = 5.0%, Rank = 0
==========
==================================================

Testando para lag = 8 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.243920
p-value: 0.154185
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 8 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.164779
p-value: 0.442594
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 8 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.127549
p-value: 0.211978
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 8 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.516636
p-value: 0.209095
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          18.21          12.32
  1   2          4.174          4.130
-------------------------------------
Para lag = 8 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          14.34          15.49
-------------------------------------
Para lag = 8 e significância = 5.0%, Rank = 0

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          15.64          18.40
-------------------------------------
Para lag = 8 e significância = 5.0%, Rank = 0
==========
:end:

*** $g_{I_{h}}$ and inflation

#+BEGIN_SRC python
testes_coint(series=df[['gIh', 'Inflation']])
#+END_SRC

#+RESULTS:
:results:
==================================================

Testando para lag = 1 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -5.111354
p-value: 0.000011
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -5.068044
p-value: 0.000123
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -5.035162
p-value: 0.000749
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 1 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -5.200449
p-value: 0.001592
CONCLUSION: REJECT null Hypothesis: there IS cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          32.15          12.32
  1   2          4.379          4.130
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          33.64          15.49
  1   2          5.997          3.841
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          33.30          18.40
  1   2          6.043          3.841
-------------------------------------
Para lag = 1 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 2 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.434234
p-value: 0.007563
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 2 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.394437
p-value: 0.042972
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 2 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.369891
p-value: 0.131885
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 2 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.437983
p-value: 0.240701
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          24.85          12.32
  1   2          5.150          4.130
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          26.66          15.49
  1   2          7.045          3.841
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          26.18          18.40
  1   2          7.097          3.841
-------------------------------------
Para lag = 2 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 3 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.434234
p-value: 0.007563
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 3 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.394437
p-value: 0.042972
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 3 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.369891
p-value: 0.131885
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 3 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -3.437983
p-value: 0.240701
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          29.82          12.32
  1   2          4.794          4.130
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          31.56          15.49
  1   2          6.492          3.841
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          30.57          18.40
  1   2          6.517          3.841
-------------------------------------
Para lag = 3 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 4 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.883375
p-value: 0.036813
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 4 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.831078
p-value: 0.155996
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 4 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.782161
p-value: 0.367608
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 4 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.812690
p-value: 0.564428
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          24.77          12.32
  1   2          8.453          4.130
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          27.57          15.49
  1   2          11.37          3.841
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          26.74          18.40
  1   2          11.42          3.841
-------------------------------------
Para lag = 4 e significância = 5.0%, Rank = 2
==========
==================================================

Testando para lag = 5 e trend = nc
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.883375
p-value: 0.036813
CONCLUSION: REJECT null Hypothesis: there IS cointegration


Testando para lag = 5 e trend = c
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.831078
p-value: 0.155996
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 5 e trend = ct
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.782161
p-value: 0.367608
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


Testando para lag = 5 e trend = ctt
Null Hypothesis: there is NO cointegration
Alternative Hypothesis: there IS cointegration
t Statistic: -2.812690
p-value: 0.564428
CONCLUSION: FAIL to reject Null Hypothesis: there is NO cointegration


TESTE DE JOHANSEN

Teste SEM constante
Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          18.99          12.32
  1   2          5.134          4.130
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 2

Teste COM constante

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          20.90          15.49
  1   2          7.201          3.841
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 2

Teste COM constante E tendência

Johansen cointegration test using trace test statistic with 5% significance level
=====================================
r_0 r_1 test statistic critical value
-------------------------------------
  0   2          19.91          18.40
  1   2          7.232          3.841
-------------------------------------
Para lag = 5 e significância = 5.0%, Rank = 2
==========
:end:

** VECM Estimation


*** Model order selection

#+BEGIN_SRC python :results latex table :eval no
from statsmodels.tsa.vector_ar.vecm import select_order

#det = 'cili'
#det = 'coli'
#det = 'colo'
det = 'cilo'
#det = 'ci'
#det = 'nc'
#det= 'co'

order_vec = select_order(
    df[[
        #"Inflation", 
        "Own Interest rate", 
        "gIh"
    ]], 
    #exog=df[["Interest rate"]],
    #seasons=4,
    maxlags=15, deterministic=det)
order_sel = order_vec.summary().as_latex_tabular(tile = "Selação ordem do VECM") 
with open('./tabs/VECM_lag_order.tex','w') as fh:
    fh.write(order_sel)

print(order_sel)
#+END_SRC

#+RESULTS:
#+begin_export latex
\begin{center}
\begin{tabular}{lcccc}
\toprule
            & \textbf{AIC} & \textbf{BIC} & \textbf{FPE} & \textbf{HQIC}  \\
\midrule
\textbf{0}  &      -16.27  &     -16.00*  &   8.617e-08  &       -16.16   \\
\textbf{1}  &      -16.24  &      -15.86  &   8.859e-08  &       -16.09   \\
\textbf{2}  &      -16.36  &      -15.87  &   7.875e-08  &       -16.16   \\
\textbf{3}  &      -16.40  &      -15.81  &   7.552e-08  &       -16.16   \\
\textbf{4}  &     -16.50*  &      -15.80  &  6.819e-08*  &      -16.22*   \\
\textbf{5}  &      -16.44  &      -15.63  &   7.296e-08  &       -16.11   \\
\textbf{6}  &      -16.39  &      -15.47  &   7.675e-08  &       -16.02   \\
\textbf{7}  &      -16.33  &      -15.30  &   8.186e-08  &       -15.91   \\
\textbf{8}  &      -16.33  &      -15.20  &   8.186e-08  &       -15.87   \\
\textbf{9}  &      -16.27  &      -15.03  &   8.768e-08  &       -15.77   \\
\textbf{10} &      -16.26  &      -14.90  &   8.941e-08  &       -15.71   \\
\textbf{11} &      -16.49  &      -15.03  &   7.113e-08  &       -15.90   \\
\textbf{12} &      -16.43  &      -14.86  &   7.637e-08  &       -15.80   \\
\textbf{13} &      -16.41  &      -14.73  &   7.847e-08  &       -15.73   \\
\textbf{14} &      -16.37  &      -14.58  &   8.310e-08  &       -15.64   \\
\textbf{15} &      -16.32  &      -14.42  &   8.854e-08  &       -15.55   \\
\bottomrule
\end{tabular}
%\caption{VECM Order Selection (* highlights the minimums)}
\end{center}
#+end_export

*** Estimation

#+BEGIN_SRC python :results latex table
model = VECM(
    endog = df[[
        #"Inflation", 
        "Own Interest rate", 
        "gIh"
    ]], 
    #exog=df[["Interest rate"]],
    #k_ar_diff=0,
    #k_ar_diff=1,
    #k_ar_diff=2,
    #k_ar_diff=3,
    k_ar_diff=4,
    #k_ar_diff=5,
    #k_ar_diff=6,
    #k_ar_diff=7,
    #k_ar_diff=8,
    deterministic=det, 
    #seasons=4,
)
results = model.fit()
adjust = results.summary().as_latex() 
with open('./tabs/VECM_ajuste.tex','w') as fh:
    fh.write(adjust)

print(adjust)
#+END_SRC

#+RESULTS:
#+begin_export latex
\begin{center}
\begin{tabular}{lcccccc}
\toprule
                              & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
\midrule
\textbf{lin\_trend}           &   -1.006e-05  &     4.13e-05     &    -0.243  &         0.808        &    -9.11e-05    &      7.1e-05     \\
\textbf{L1.Own Interest rate} &       0.0325  &        0.111     &     0.294  &         0.769        &       -0.185    &        0.250     \\
\textbf{L1.gIh}               &       0.0650  &        0.082     &     0.792  &         0.428        &       -0.096    &        0.226     \\
\textbf{L2.Own Interest rate} &      -0.0074  &        0.109     &    -0.068  &         0.946        &       -0.222    &        0.207     \\
\textbf{L2.gIh}               &       0.1069  &        0.081     &     1.322  &         0.186        &       -0.052    &        0.265     \\
\textbf{L3.Own Interest rate} &       0.0814  &        0.118     &     0.689  &         0.491        &       -0.150    &        0.313     \\
\textbf{L3.gIh}               &       0.1080  &        0.069     &     1.573  &         0.116        &       -0.027    &        0.243     \\
\textbf{L4.Own Interest rate} &       0.2695  &        0.119     &     2.262  &         0.024        &        0.036    &        0.503     \\
                              & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
\midrule
\textbf{lin\_trend}           &      -0.0003  &      6.5e-05     &    -3.900  &         0.000        &       -0.000    &       -0.000     \\
\textbf{L1.Own Interest rate} &      -0.1837  &        0.174     &    -1.054  &         0.292        &       -0.525    &        0.158     \\
\textbf{L1.gIh}               &      -0.4237  &        0.129     &    -3.283  &         0.001        &       -0.677    &       -0.171     \\
\textbf{L2.Own Interest rate} &      -1.0134  &        0.172     &    -5.891  &         0.000        &       -1.351    &       -0.676     \\
\textbf{L2.gIh}               &      -0.4647  &        0.127     &    -3.651  &         0.000        &       -0.714    &       -0.215     \\
\textbf{L3.Own Interest rate} &      -0.6084  &        0.186     &    -3.273  &         0.001        &       -0.973    &       -0.244     \\
\textbf{L3.gIh}               &      -0.2099  &        0.108     &    -1.943  &         0.052        &       -0.422    &        0.002     \\
\textbf{L4.Own Interest rate} &      -0.5464  &        0.187     &    -2.915  &         0.004        &       -0.914    &       -0.179     \\
\textbf{L4.gIh}               &      -0.2536  &        0.084     &    -3.022  &         0.003        &       -0.418    &       -0.089     \\
             & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
\midrule
\textbf{ec1} &      -0.0119  &        0.068     &    -0.177  &         0.860        &       -0.145    &        0.121     \\
             & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
\midrule
\textbf{ec1} &      -0.4114  &        0.106     &    -3.863  &         0.000        &       -0.620    &       -0.203     \\
                & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
\midrule
\textbf{beta.1} &       1.0000  &            0     &         0  &         0.000        &        1.000    &        1.000     \\
\textbf{beta.2} &       1.3177  &        0.156     &     8.429  &         0.000        &        1.011    &        1.624     \\
\textbf{const}  &      -0.1127  &        0.009     &   -11.928  &         0.000        &       -0.131    &       -0.094     \\
\bottomrule
\end{tabular}
%\caption{Det. terms outside the coint. relation & lagged endog. parameters for equation Own Interest rate}
\end{center}
#+end_export

*** Impsulse respose

**** Orthoganalized

#+BEGIN_SRC python :results graphics file :file ./figs/Impulse_VECMOrth.png
p = results.irf(20).plot(orth=True, subplot_params={"color": "black"})
p.suptitle("")
sns.despine()

p.savefig(
    "./figs/Impulse_VECMOrth.png",
    dpi=300,
    bbox_inches="tight",
    pad_inches=0.0,
    transparent=False,
)
plt.close("all")


img = Image.open("./figs/Impulse_VECMOrth.png").convert("LA")
img.save("./figs/Impulse_VECMOrth_grey.png")
#+END_SRC

#+RESULTS:
[[file:./figs/Impulse_VECMOrth.png]]

**** Non-Orthoganalized

#+BEGIN_SRC python :results graphics file :file ./figs/Impulse_VECM.png
p = results.irf(20).plot(orth=False)
p.suptitle("")
sns.despine()


p.savefig("./figs/Impulse_VECM.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.0, transparent = False,)
plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/Impulse_VECM.png]]

*** FEVD
**** Python version
#+BEGIN_SRC python :results graphics file :file ./figs/FEVD_VECMpython_TxPropria.png
fig = FEVD(results, periods=21).plot()
fig.savefig("./figs/FEVD_VECMpython_TxPropria.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.2, transparent = False,)
plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/FEVD_VECMpython_TxPropria.png]]
**** R version
#+begin_src ess-r :eval no
library(tsDyn)
library(readr)
df <- read.csv("../data/Data_yeojohnson.csv", encoding="UTF-8")
#df <- df[,c(4:7)]
names(df) <- c("Time","Infla", "gIh", "Own", "Interest rate")
df <- na.omit(df[,c("Time","Infla", "gIh", "Own", "Interest rate")])
df <- ts(data = df, start = c(1992,03), frequency = 4)
model <- tsDyn::VECM(data = df[,c("Own","gIh")], lag = 4, r = 1, estim = "ML", LRinclude="both", include="none")
fevd_gIh = data.frame(tsDyn::fevd(model, 20)$gIh)
fevd_tx = data.frame(tsDyn::fevd(model, 20)$Own)
#+end_src

*** Granger-Causality test 
#+BEGIN_SRC python
series = residuals.columns
print(results.test_granger_causality(causing=series[0], caused=series[1]).summary())
print(results.test_inst_causality(causing=series[0]).summary())
#+END_SRC

#+RESULTS:
:results:
:end:


*** Post estimation
#+BEGIN_SRC python
residuals = analise_residuos(results=results)
#+END_SRC

#+RESULTS:
:results:
AUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU

Portmanteau-test for residual autocorrelation. H_0: residual autocorrelation up to lag 15 is zero. Conclusion: fail to reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         50.51          58.12   0.173 42
----------------------------------------

AUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU AJUSTADO

Adjusted Portmanteau-test for residual autocorrelation. H_0: residual autocorrelation up to lag 15 is zero. Conclusion: fail to reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         55.53          58.12   0.079 42
----------------------------------------

LJUNGBOX

H0: autocorrelations up to lag k equal zero
H1: autocorrelations up to lag k not zero
Box-Pierce:  False
Testing for  OWN INTEREST RATE . Considering a significance level of 5.0 %
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:524: FutureWarning: The value returned will change to a single DataFrame after 0.12 is released.  Set return_df to True to use to return a DataFrame now.  Set return_df to False to silence this warning.
  warnings.warn(msg, FutureWarning)
p-value = 0.9193477883797351
Reject H0 on lag  1 ?  False

p-value = 0.9878756917264138
Reject H0 on lag  2 ?  False

p-value = 0.9396537698741769
Reject H0 on lag  3 ?  False

p-value = 0.8965616275035287
Reject H0 on lag  4 ?  False

p-value = 0.9551438420906964
Reject H0 on lag  5 ?  False

p-value = 0.9361298929124949
Reject H0 on lag  6 ?  False

p-value = 0.9074751487878628
Reject H0 on lag  7 ?  False

p-value = 0.7063973854363028
Reject H0 on lag  8 ?  False

p-value = 0.647689774346883
Reject H0 on lag  9 ?  False

p-value = 0.5335423481154282
Reject H0 on lag  10 ?  False

p-value = 0.5635215753829743
Reject H0 on lag  11 ?  False

p-value = 0.639391846027429
Reject H0 on lag  12 ?  False



Testing for  GIH . Considering a significance level of 5.0 %
p-value = 0.29095211300396007
Reject H0 on lag  1 ?  False

p-value = 0.3201553663446565
Reject H0 on lag  2 ?  False

p-value = 0.3512504081022989
Reject H0 on lag  3 ?  False

p-value = 0.6980480183415101
Reject H0 on lag  4 ?  False

p-value = 2.6912644596934605
Reject H0 on lag  5 ?  False

p-value = 2.711883938706883
Reject H0 on lag  6 ?  False

p-value = 2.743715002535212
Reject H0 on lag  7 ?  False

p-value = 4.246864113466479
Reject H0 on lag  8 ?  False

p-value = 4.393315823669711
Reject H0 on lag  9 ?  False

p-value = 4.485571716132848
Reject H0 on lag  10 ?  False

p-value = 8.495769423727353
Reject H0 on lag  11 ?  False

p-value = 10.11716962494874
Reject H0 on lag  12 ?  False




BOXPIERCE

H0: autocorrelations up to lag k equal zero
H1: autocorrelations up to lag k not zero
Box-Pierce:  True
Testing for  OWN INTEREST RATE . Considering a significance level of 5.0 %
p-value = 0.920482660566307
Reject H0 on lag  1 ?  False

p-value = 0.9882789317018735
Reject H0 on lag  2 ?  False

p-value = 0.9434569012725278
Reject H0 on lag  3 ?  False

p-value = 0.9054063928908398
Reject H0 on lag  4 ?  False

p-value = 0.9600075425786178
Reject H0 on lag  5 ?  False

p-value = 0.945031054599083
Reject H0 on lag  6 ?  False

p-value = 0.9228027759713657
Reject H0 on lag  7 ?  False

p-value = 0.7548479044597016
Reject H0 on lag  8 ?  False

p-value = 0.7088016753332314
Reject H0 on lag  9 ?  False

p-value = 0.6132319226410103
Reject H0 on lag  10 ?  False

p-value = 0.6467414080020828
Reject H0 on lag  11 ?  False

p-value = 0.7185670570505887
Reject H0 on lag  12 ?  False



Testing for  GIH . Considering a significance level of 5.0 %
p-value = 0.29095211300396007
Reject H0 on lag  1 ?  False

p-value = 0.3201553663446565
Reject H0 on lag  2 ?  False

p-value = 0.3512504081022989
Reject H0 on lag  3 ?  False

p-value = 0.6980480183415101
Reject H0 on lag  4 ?  False

p-value = 2.6912644596934605
Reject H0 on lag  5 ?  False

p-value = 2.711883938706883
Reject H0 on lag  6 ?  False

p-value = 2.743715002535212
Reject H0 on lag  7 ?  False

p-value = 4.246864113466479
Reject H0 on lag  8 ?  False

p-value = 4.393315823669711
Reject H0 on lag  9 ?  False

p-value = 4.485571716132848
Reject H0 on lag  10 ?  False

p-value = 8.495769423727353
Reject H0 on lag  11 ?  False

p-value = 10.11716962494874
Reject H0 on lag  12 ?  False




NORMALIDADE

normality (skew and kurtosis) test. H_0: data generated by normally-distributed process. Conclusion: reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         46.79          9.488   0.000  4
----------------------------------------

HOMOCEDASTICIDADE

H0: Residuals are homoscedastic
H1: Residuals are heteroskedastic
Testing for  OWN INTEREST RATE
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:622: FutureWarning: The default value of nlags is changing.  After 0.12, this value will become min(10, nobs//5). Directly setmaxlags or period to silence this warning.
  warnings.warn("The default value of nlags is changing.  After 0.12, "
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:645: FutureWarning: autolag is deprecated and will be removed after 0.12. Model selection before testing fails to control test size. Set autolag to False to silence this warning.
  warnings.warn("autolag is deprecated and will be removed after 0.12. "
LM statistic:  1.824144218783971
LM p-value:  0.17682076991628956
Reject H0?  False
F statistic:  1.8210046678187017
F p-value:  0.1801813687259512
Reject H0?  False


Testing for  GIH
LM statistic:  3.669319441445647
LM p-value:  0.0554228100979981
Reject H0?  False
F statistic:  3.7303702211909844
F p-value:  0.05620696750808147
Reject H0?  False
:end:

**** Visual inspection

#+BEGIN_SRC python
series = results.names
for serie in series:
    sns.scatterplot(x = residuals[serie], y = residuals[serie]**2)
    plt.ylabel(f"{serie}^2")
    sns.despine()
    
    plt.close('all')
    sns.scatterplot(
    y = residuals[serie], 
    x = residuals[serie].shift(-1), 
    color = 'darkred' 
    )
    sns.despine()
    plt.xlabel(f"{serie}(-1)")
    
    plt.close('all')
#+END_SRC

#+RESULTS:
:results:
:end:
***** All residuals
#+BEGIN_SRC python :results graphics file :file ./figs/Residuals_4VECM.png
plt.tight_layout()
g.savefig("./figs/Residuals_4VECM.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.2, transparent = False,)
plt.close(g)
#+END_SRC

#+RESULTS:
[[file:./figs/Residuals_4VECM.png]]
***** Residuals vs Residuals
#+BEGIN_SRC python
series = results.names
ax = sns.jointplot(
    x = series[0], 
    y = series[1], 
    data = residuals, color = 'darkred', kind="reg", 
)
plt.close('all')
#+END_SRC

#+RESULTS:
:results:
:end:
***** Lags vs Lags
#+BEGIN_SRC python :results graphics file :file ./figs/VEC_Defasagens.png
fig = plot_lags(results=results, trimestres=[1,4])
fig.savefig("./figs/VEC_Defasagens.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.2, transparent = False,)
plt.close(fig)
#+END_SRC

#+RESULTS:
[[file:./figs/VEC_Defasagens.png]]

**** Residuals stationarity
***** $g_{_{h}}$
#+BEGIN_SRC python
testes_raiz(residuals['gIh'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                -10.644
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.355
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                -10.016
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -5.952
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -9.016
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -0.615
P-value                         0.467
Lags                               11
-------------------------------------

Trend: Constant
Critical Values: -2.77 (1%), -2.15 (5%), -1.84 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.095
P-value                         0.611
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
:end:

***** own interest rate

#+BEGIN_SRC python
testes_raiz(residuals['Own Interest rate'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                -10.063
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.782
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -9.578
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -6.188
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -9.509
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -0.945
P-value                         0.316
Lags                               12
-------------------------------------

Trend: Constant
Critical Values: -2.77 (1%), -2.15 (5%), -1.84 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.047
P-value                         0.897
Lags                                1
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.249
P-value                         0.190
Lags                               47
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -9.559
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -34.150
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

** VAR Estimation

VAR: $\Delta \text{own} \sim \Delta g_{I_{h}}$

*** Order selection

#+BEGIN_SRC python 
model = VAR(
    df[["d_Own Interest rate", 'd_gIh']],
)
print(model.select_order(maxlags=15, trend='ct').summary())
#+END_SRC

#+RESULTS:
:results:
 VAR Order Selection (* highlights the minimums)
==================================================
       AIC         BIC         FPE         HQIC
--------------------------------------------------
0       -15.75      -15.64   1.450e-07      -15.70
1       -15.91      -15.69   1.237e-07      -15.82
2       -16.24     -15.92*   8.851e-08      -16.11
3       -16.20      -15.77   9.185e-08      -16.03
4       -16.35      -15.81  7.973e-08*     -16.13*
5       -16.34      -15.69   8.034e-08      -16.08
6       -16.31      -15.56   8.274e-08      -16.01
7       -16.25      -15.39   8.830e-08      -15.90
8       -16.29      -15.32   8.540e-08      -15.89
9       -16.24      -15.17   8.922e-08      -15.81
10      -16.25      -15.07   8.899e-08      -15.77
11     -16.36*      -15.07   7.995e-08      -15.84
12      -16.34      -14.95   8.203e-08      -15.78
13      -16.33      -14.82   8.401e-08      -15.72
14      -16.25      -14.64   9.150e-08      -15.60
15      -16.18      -14.46   9.898e-08      -15.49
--------------------------------------------------
:end:

*** Estimation

#+BEGIN_SRC python
results = model.fit(maxlags=4)
print(results.summary())
#+END_SRC

#+RESULTS:
:results:
  Summary of Regression Results
==================================
Model:                         VAR
Method:                        OLS
Date:           qui, 25, mar, 2021
Time:                     12:06:44
--------------------------------------------------------------------
No. of Equations:         2.00000    BIC:                   -15.9305
Nobs:                     106.000    HQIC:                  -16.1995
Log likelihood:           585.473    FPE:                7.68062e-08
AIC:                     -16.3828    Det(Omega_mle):     6.52548e-08
--------------------------------------------------------------------
Results for equation d_Own Interest rate
=========================================================================================
                            coefficient       std. error           t-stat            prob
-----------------------------------------------------------------------------------------
const                         -0.000231         0.001273           -0.181           0.856
L1.d_Own Interest rate         0.027850         0.107999            0.258           0.797
L1.d_gIh                       0.053825         0.060733            0.886           0.375
L2.d_Own Interest rate        -0.010285         0.110389           -0.093           0.926
L2.d_gIh                       0.102390         0.074263            1.379           0.168
L3.d_Own Interest rate         0.083484         0.123566            0.676           0.499
L3.d_gIh                       0.104809         0.067728            1.548           0.122
L4.d_Own Interest rate         0.272821         0.123043            2.217           0.027
L4.d_gIh                       0.054811         0.053668            1.021           0.307
=========================================================================================

Results for equation d_gIh
=========================================================================================
                            coefficient       std. error           t-stat            prob
-----------------------------------------------------------------------------------------
const                         -0.003136         0.002158           -1.453           0.146
L1.d_Own Interest rate        -0.413604         0.183004           -2.260           0.024
L1.d_gIh                      -0.791193         0.102913           -7.688           0.000
L2.d_Own Interest rate        -1.179998         0.187054           -6.308           0.000
L2.d_gIh                      -0.693607         0.125839           -5.512           0.000
L3.d_Own Interest rate        -0.582592         0.209383           -2.782           0.005
L3.d_gIh                      -0.353889         0.114765           -3.084           0.002
L4.d_Own Interest rate        -0.443669         0.208497           -2.128           0.033
L4.d_gIh                      -0.356426         0.090941           -3.919           0.000
=========================================================================================

Correlation matrix of residuals
                       d_Own Interest rate     d_gIh
d_Own Interest rate               1.000000 -0.395026
d_gIh                            -0.395026  1.000000
:end:


*** Impsulse respose

**** Orthoganalized

#+BEGIN_SRC python :results graphics file :file ./figs/Impulse_VAROrth.png
p = results.irf(20).plot(orth=True)
sns.despine()

p.savefig("./figs/Impulse_VAROrth.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.0, transparent = False,)

plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/Impulse_VAROrth.png]]

**** Non-Orthoganalized

#+BEGIN_SRC python :results graphics file :file ./figs/Impulse_VAR.png
p = results.irf(20).plot(orth=False)
p.suptitle("")
sns.despine()


p.savefig("./figs/Impulse_VAR.png", dpi = 300, bbox_inches = 'tight',
    pad_inches = 0.0, transparent = False,)
plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/Impulse_VAR.png]]

**** Cumulative effect

#+BEGIN_SRC python :results graphics file :file ./figs/Impulse_Cum.png
p = results.irf(20).plot_cum_effects(orth=True)
sns.despine()
p.savefig("./figs/Impulse_Cum.png", dpi = 300)
#+END_SRC

#+RESULTS:
[[file:./figs/Impulse_Cum.png]]


*** FEVD
#+BEGIN_SRC python :results graphics file :file ./figs/FEVD_VAR.png
p = results.fevd(20).plot()
sns.despine()
p.savefig("./figs/FEVD_VAR.png", dpi = 300)
#+END_SRC

#+RESULTS:
[[file:./figs/FEVD_VAR.png]]
*** Granger-Causality test
#+BEGIN_SRC python
series = residuals.columns
print(results.test_causality(causing = series[0], caused=series[1]).summary())
print(results.test_causality(causing = series[1], caused=series[0]).summary())
#+END_SRC

#+RESULTS:
:results:
:end:


*** Post estimation
**** Residuals auto-correlation
#+BEGIN_SRC python
results.plot_acorr(nlags = 20)
sns.despine()
plt.show()
plt.close()
#+END_SRC

#+RESULTS:
:results:
:end:
**** Model stability
#+BEGIN_SRC python
print("Estável:", results.is_stable(verbose=True))
#+END_SRC

#+RESULTS:
:results:
Eigenvalues of VAR(1) rep
0.6015228789010414
0.7064600426330642
0.7064600426330642
0.7463489089954227
0.7463489089954227
0.6584992389763756
0.8137641754439946
0.8137641754439946
Estável: True
:end:


**** Visual inspection
#+BEGIN_SRC python
residuals = analise_residuos(results=results)
#+END_SRC

#+RESULTS:
:results:
AUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU

Portmanteau-test for residual autocorrelation. H_0: residual autocorrelation up to lag 15 is zero. Conclusion: fail to reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         51.21          60.48   0.212 44
----------------------------------------

AUTOCORRELAÇÃO RESIDUAL: PORTMANTEAU AJUSTADO

Adjusted Portmanteau-test for residual autocorrelation. H_0: residual autocorrelation up to lag 15 is zero. Conclusion: fail to reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         55.87          60.48   0.108 44
----------------------------------------

LJUNGBOX

H0: autocorrelations up to lag k equal zero
H1: autocorrelations up to lag k not zero
Box-Pierce:  False
Testing for  D_OWN INTEREST RATE . Considering a significance level of 5.0 %
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:524: FutureWarning: The value returned will change to a single DataFrame after 0.12 is released.  Set return_df to True to use to return a DataFrame now.  Set return_df to False to silence this warning.
  warnings.warn(msg, FutureWarning)
p-value = 0.9973606386840764
Reject H0 on lag  1 ?  False

p-value = 0.9539586890764923
Reject H0 on lag  2 ?  False

p-value = 0.9368336607096326
Reject H0 on lag  3 ?  False

p-value = 0.9471078055859504
Reject H0 on lag  4 ?  False

p-value = 0.9244145750436498
Reject H0 on lag  5 ?  False

p-value = 0.9434398460183713
Reject H0 on lag  6 ?  False

p-value = 0.7696814471174311
Reject H0 on lag  7 ?  False

p-value = 0.6929501529602125
Reject H0 on lag  8 ?  False

p-value = 0.6729641202994736
Reject H0 on lag  9 ?  False

p-value = 0.6234625655624791
Reject H0 on lag  10 ?  False

p-value = 0.6980758439515145
Reject H0 on lag  11 ?  False

p-value = 0.6511516612929609
Reject H0 on lag  12 ?  False



Testing for  D_GIH . Considering a significance level of 5.0 %
p-value = 0.2611574752558545
Reject H0 on lag  1 ?  False

p-value = 0.29576698228382076
Reject H0 on lag  2 ?  False

p-value = 0.34817774978463073
Reject H0 on lag  3 ?  False

p-value = 0.6517238688246135
Reject H0 on lag  4 ?  False

p-value = 2.6515314192347557
Reject H0 on lag  5 ?  False

p-value = 2.6873847518761758
Reject H0 on lag  6 ?  False

p-value = 2.705349212733215
Reject H0 on lag  7 ?  False

p-value = 4.163025452862863
Reject H0 on lag  8 ?  False

p-value = 4.289817626927582
Reject H0 on lag  9 ?  False

p-value = 4.387189861960584
Reject H0 on lag  10 ?  False

p-value = 8.545561294958002
Reject H0 on lag  11 ?  False

p-value = 10.211028613180247
Reject H0 on lag  12 ?  False




BOXPIERCE

H0: autocorrelations up to lag k equal zero
H1: autocorrelations up to lag k not zero
Box-Pierce:  True
Testing for  D_OWN INTEREST RATE . Considering a significance level of 5.0 %
p-value = 0.9973975545145886
Reject H0 on lag  1 ?  False

p-value = 0.9556254565681455
Reject H0 on lag  2 ?  False

p-value = 0.940655834290468
Reject H0 on lag  3 ?  False

p-value = 0.9516152437296213
Reject H0 on lag  4 ?  False

p-value = 0.932869146356887
Reject H0 on lag  5 ?  False

p-value = 0.951233017263707
Reject H0 on lag  6 ?  False

p-value = 0.8039567288260984
Reject H0 on lag  7 ?  False

p-value = 0.7412697488225687
Reject H0 on lag  8 ?  False

p-value = 0.7291212141977832
Reject H0 on lag  9 ?  False

p-value = 0.6918801349035346
Reject H0 on lag  10 ?  False

p-value = 0.7613824249958802
Reject H0 on lag  11 ?  False

p-value = 0.728654587412132
Reject H0 on lag  12 ?  False



Testing for  D_GIH . Considering a significance level of 5.0 %
p-value = 0.2611574752558545
Reject H0 on lag  1 ?  False

p-value = 0.29576698228382076
Reject H0 on lag  2 ?  False

p-value = 0.34817774978463073
Reject H0 on lag  3 ?  False

p-value = 0.6517238688246135
Reject H0 on lag  4 ?  False

p-value = 2.6515314192347557
Reject H0 on lag  5 ?  False

p-value = 2.6873847518761758
Reject H0 on lag  6 ?  False

p-value = 2.705349212733215
Reject H0 on lag  7 ?  False

p-value = 4.163025452862863
Reject H0 on lag  8 ?  False

p-value = 4.289817626927582
Reject H0 on lag  9 ?  False

p-value = 4.387189861960584
Reject H0 on lag  10 ?  False

p-value = 8.545561294958002
Reject H0 on lag  11 ?  False

p-value = 10.211028613180247
Reject H0 on lag  12 ?  False




NORMALIDADE

normality (skew and kurtosis) test. H_0: data generated by normally-distributed process. Conclusion: reject H_0 at 5% significance level.
========================================
Test statistic Critical value p-value df
----------------------------------------
         50.02          9.488   0.000  4
----------------------------------------

HOMOCEDASTICIDADE

H0: Residuals are homoscedastic
H1: Residuals are heteroskedastic
Testing for  D_OWN INTEREST RATE
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:622: FutureWarning: The default value of nlags is changing.  After 0.12, this value will become min(10, nobs//5). Directly setmaxlags or period to silence this warning.
  warnings.warn("The default value of nlags is changing.  After 0.12, "
/home/gpetrini/.local/lib/python3.8/site-packages/statsmodels/stats/diagnostic.py:645: FutureWarning: autolag is deprecated and will be removed after 0.12. Model selection before testing fails to control test size. Set autolag to False to silence this warning.
  warnings.warn("autolag is deprecated and will be removed after 0.12. "
LM statistic:  1.8048861590726846
LM p-value:  0.17912290275420933
Reject H0?  False
F statistic:  1.8014736111542173
F p-value:  0.18248549627479257
Reject H0?  False


Testing for  D_GIH
LM statistic:  1.0758297016285518
LM p-value:  0.29963235697396456
Reject H0?  False
F statistic:  1.0662626312011751
F p-value:  0.3042096558365478
Reject H0?  False
:end:

#+BEGIN_SRC python
series = results.names
sns.set_context('talk')
ax = sns.jointplot(
    x = series[0], 
    y = series[1], 
    data = residuals, color = 'darkred', kind="reg", 
)
plt.show()
plt.close('all')
#+END_SRC

#+RESULTS:
:results:
:end:

***** All residuals
#+BEGIN_SRC python :results graphics file :file ./figs/Residuals_4VAR.png
g = sns.PairGrid(residuals, diag_sharey=False, height = 5, aspect=(8/5))
g.map_lower(sns.kdeplot, color = 'darkred')
g.map_upper(sns.scatterplot, color = 'darkred')
g.map_diag(sns.kdeplot, lw=3, color = 'darkred')
g.savefig("./figs/Residuals_4VAR.png", dpi = 600, )
plt.close('all')
#+END_SRC

#+RESULTS:
[[file:./figs/Residuals_4VAR.png]]
***** Residuals vs Residuals
#+BEGIN_SRC python :results graphics
series = results.names
for serie in series:
    sns.scatterplot(x = residuals[serie], y = residuals[serie]**2)
    sns.despine()
    
    sns.scatterplot(
    y = residuals[serie], 
    x = residuals[serie].shift(-1), 
    color = 'darkred' 
    )
    sns.despine()
    plt.xlabel(f"{serie}(-1)")

plt.close('all')
#+END_SRC

#+RESULTS:
***** Lags vs Lags
#+BEGIN_SRC python :results graphics file :file ./figs/VEC_Defasagens.png
plot_lags(results=results)
#+END_SRC

#+RESULTS:
[[file:./figs/VEC_Defasagens.png]]

**** Residuals stationarity
***** $g_{_{h}}$
#+BEGIN_SRC python
testes_raiz(residuals['d_gIh'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                -10.739
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.180
P-value                         0.001
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                -10.282
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -5.691
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -0.926
P-value                         0.324
Lags                                6
-------------------------------------

Trend: Constant
Critical Values: -2.76 (1%), -2.14 (5%), -1.83 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -0.797
P-value                         0.381
Lags                               11
-------------------------------------

Trend: Constant
Critical Values: -2.77 (1%), -2.15 (5%), -1.84 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.144
P-value                         0.410
Lags                                1
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
:end:

***** own interest rate

#+BEGIN_SRC python
testes_raiz(residuals['d_Own Interest rate'])
#+END_SRC

#+RESULTS:
:results:

ZIVOT ANDREWS level series
        Zivot-Andrews Results
=====================================
Test Statistic                -10.177
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ZIVOT ANDREWS First differences
        Zivot-Andrews Results
=====================================
Test Statistic                 -6.838
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -5.28 (1%), -4.81 (5%), -4.57 (10%)
Null Hypothesis: The process contains a unit root with a single structural break.
Alternative Hypothesis: The process is trend and break stationary.


ADF level series
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -9.659
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


ADF First differences
   Augmented Dickey-Fuller Results
=====================================
Test Statistic                 -6.196
P-value                         0.000
Lags                                9
-------------------------------------

Trend: Constant
Critical Values: -3.50 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS level series
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -9.157
P-value                         0.000
Lags                                0
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


DFGLS First differences
      Dickey-Fuller GLS Results
=====================================
Test Statistic                 -9.567
P-value                         0.000
Lags                                2
-------------------------------------

Trend: Constant
Critical Values: -2.75 (1%), -2.13 (5%), -1.82 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


KPSS em nível
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.045
P-value                         0.904
Lags                                1
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


KPSS em primeira diferença
    KPSS Stationarity Test Results
=====================================
Test Statistic                  0.233
P-value                         0.212
Lags                               43
-------------------------------------

Trend: Constant
Critical Values: 0.74 (1%), 0.46 (5%), 0.35 (10%)
Null Hypothesis: The process is weakly stationary.
Alternative Hypothesis: The process contains a unit root.


Phillips Perron em nível
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                 -9.643
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.


Phillips Perron em primeira diferença
     Phillips-Perron Test (Z-tau)
=====================================
Test Statistic                -34.776
P-value                         0.000
Lags                               13
-------------------------------------

Trend: Constant
Critical Values: -3.49 (1%), -2.89 (5%), -2.58 (10%)
Null Hypothesis: The process contains a unit root.
Alternative Hypothesis: The process is weakly stationary.
:end:

** Fora


textcite:arestis_residential_2015 argue that the last house bubble episode (during the 2000s to the US economy) changed the traditional view on the motivations to acquire housing.
Accordingly to previous view, house was a durable good that renders a service through it lifetime to its owner.
As well, it is a way of investing wealth more accessible to most households than others options, like stock shares.
During the bubble, households would acquire housings only to sell it later with capital gains.
Or, would benefit from renting their properties.

The speculative behavior was disseminated through households (see figure ref:fig:mort_houses).
Bottom 50% of households with wealth increased their acquisition of housing and also their mortgage indebtedness.
This movement supports the ordinary view of the Great Recession as originated by a subprime crisis cite:mian_consequences_2009.
The top 1%, however, also increased their wealth in form of housing, as well as their mortgage debts, corroborating to a "New narrative" of the crisis cite:albanesi_2017_Credit.
As discussed before, this housing boom was possible because of some changes of housing market regulation and housing finance cite:federal_deposit_insurance_corporation_savings_1997,mccarthyMonetaryPolicyTransmission2002,wall_too_2010.

#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Houses and Mortgage shares evolution by wealth percentile (1989/07=1)}
	\label{fig:mort_houses}
	\includegraphics[width=.9\textwidth]{./figs/Houses_Mortgages.png}
	\caption*{\textbf{Source:} Board of Governors of the Federal Reserve System (US), Authors' Elaboration}
\end{figure}
#+end_export

#+BEGIN_EXPORT latex
\begin{figure}[htb]
	\centering
	\caption{Mortgage and Consumer credit growth rate (1979-2019)}
	\label{Fig:CreditFDICIA}
	\includegraphics[width=\textwidth]{./figs/FDICIA.png}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' elaboration}
\end{figure}
#+END_EXPORT


Figure ref:Fig:CreditFDICIA illustrates the relevance of institutional reforms due to the savings and loans crisis throughout the 80's and early 90's.



#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Average construction time (approval to completion) of properties for a family unit by construction purposes except manufactured houses (1976-2018)}
    \label{meses}
	\includegraphics[width=\textwidth]{./figs/Meses_construcao.png}
	\caption*{\textbf{Source:} Survey of Construction (SOC), Authors' elaboration}
\end{figure}
#+end_export


#+begin_export latex
\begin{figure}
	\centering
	\caption{Dispersion between houses' own interest rate and residential investment growth: lags selected based on information criteria}
	\label{defasagens}
	\includegraphics[height=.4\textheight]{./figs/VEC_Defasagens.png}
	\caption*{\textbf{Source:} Authors' elaboration}
\end{figure}
#+end_export

#+BEGIN_latex
\begin{equation}
\Delta own_t = \delta_{1} + \alpha_1\left(\sigma_{t-1}) + \sum^{N}_{i=1}\beta_{1,i}\cdot \Delta g_{I_{h_{t-i}}} +
\sum^{N}_{i=1}\gamma_{1,i}\cdot \Delta own_{t-i} +\varepsilon_{t,1}
\\
\Delta g_{I_{h_{t}}} = \delta_{2} + \alpha_2\left(\sigma_{t-1}) + \sum^{N}_{i=1}\beta_{2,i}\cdot \Delta g_{I_{h_{t-i}}} +
\sum^{N}_{i=1}\gamma_{2,i}\cdot \Delta own_{t-i} +\varepsilon_{t,2}
\end{equation}
#+END_latex


At this stage, we restrict the comparison with  textcite:gauger_residential_2003 and textcite:arestis_residential_2015 since both of them analyze residential investment determinants after the institutional changes of the 90's.
Similar to textcite:gauger_residential_2003, we report that mortgage interest rate is relevant for residential investment.
Our results regarding the positive price effect on residential investment are in line with textcite:arestis_residential_2015 (at least for the US).
However, they report statistically insignificant coefficients for mortgages nominal interest rate which is at odds with our conclusions.

* VECM :ignore:

** Houses own-rate of interest and residential investment growth rate in the US Economy
#+LATEX: \label{sec:own}

From the previous section, we conclude that house prices (nominal or deflated by consumer price index) and some rate of interest (mortgage or long term, as proxy) may be the only consensus about residential investment determinants.
In this section, we present a particular and parsimonious way of combining those two variables  in a single index that we will use on our econometric estimation.


With the purpose of analysing the 2000s US housing boom episode, textcite:teixeira_crescimento_2015  proposed the index named houses own-rate of interest ($own$).
Inspired by \citeauthor*{sraffaDrHayekMoney1932}'s citeyear:sraffaDrHayekMoney1932 commodity rate, this variable is the mortgage interest rate ($r_{mo}$) deflated by house price inflation ($\pi$) as follows:
#+BEGIN_latex
\begin{equation}
\label{txpropria}
own =  \left(\frac{1+r_{mo}}{1+\pi} - 1\right)
\end{equation}
#+END_latex
Equation ref:txpropria represents this particular real interest rate which is the combination of the relevant nominal rate of interest with the relevant prince index for the one acquiring a new house.
It is the real cost in houses from buying houses  \cite[p.~53]{teixeira_crescimento_2015}.
The lower the house own-rate of interest, the greater the rate of growth of residential investment ($g_{I_{h}}$, see Figure ref:propria_investo).
We do not assume that houses own-rate of interest is the only determinant of residential investment.
While they share a negative correlation in the short run, there are long term determinants of residential investment such as demographic factors, urbanization, credit policy, among others.

# Based on this discussion we assume that residential investment has a long term trend associate do demographic factors, urbanization and credit policy, while, in the short run, it shows a negative relation with houses own-rate of interest
# Additionally, the latter parameter also include the residential investment demand arising from expectations of capital gains resulting from speculation with the existing houses stock.
# During a housing bubble period (/e.g./ 2002-5 in the US), it is house price inflation that governs houses own-rate of interest.
# So, the lower this rate is, the greater the capital gains (in house) for speculating with house will be.
# However, this not imply that all demand for houses during this period will be determined only by speculative purposes.

#+begin_export latex
\begin{figure}[htb]
	\centering
	\caption{Residential investment growth rate vs. Houses own-rate of interest}
	\label{propria_investo}
	\includegraphics[width=\textwidth]{./figs/TxPropria_Investo.png}
	\caption*{\textbf{Source:} U.S. Bureau of Economic Analysis, Authors' elaboration}
\end{figure}
#+end_export

Despite shedding light on the connection between house prices, mortgage interest rate and residential investment, \citeauthor*{teixeira_crescimento_2015}'s \citeyear{teixeira_crescimento_2015} proposition has not been evaluated econometrically.
More recently, textcite:petrini_2021_TD simulated a Stock-Flow Consistent model for the US in which the rate of growth residential investment is governed by houses own-rate of interest.
In their demand-led model, this expenditure leads growth and business cycles and it is capable of replicating some of the stylized facts presented in Section ref:sec:Stylized_Facts.
In this sense, our work aims at empirically evaluating the relation between houses own-rate of interest and rate of growth of residential investment.


** Data and estimation strategy
#+LATEX: \label{sec:estimation}

In this subsection we present the estimation estrategy and the data used to assess whether house own-rate of interest explains the behavior of residential investment rate of growth.
Our sample period (1992:Q1 to 2019:Q1) starts after institutional changes due to the Savings and Loans crisis of the 1980s (see Table ref:structbreak in appendix ref:appen:A for structural break tests)[fn::In addition to the institucional changes mentioned in footnote @@latex: \footref{nota_instituicoes}@@, the Reform, Recovery, and Enforcement Act (FIRREA) in 1989 and Federal Deposit Insurance Corporation Improvement Act (FDICIA) in 1991 were important in increasing the credit volume to households. As a consequence, house finance has increased considerably in the following periods cite:wall_too_2010.].
We rely on the following  quarterly seasonally adjusted data[fn::All the date is from FRED database. The codes are MORTGAGE30US, PRFI, and CSUSHPISA respectively. We resampled all the non-quarterly data series by end of the quarter and define growth rate as percent change from the previous quarter.]: (i) 30-year fixed mortgage interest rate, private residential investment and Case-Shiller home price index.
# Additionally, we consider mortgage interest rate as an exogenous variable in all tests and estimations.


Since we are interested in growth rate variables, we apply textcite:yeo_new_2000 transformation.
This procedure is similar to textcite:box_analysis_1964 but more adequate in the presence of non-positive values.
Then, we employ standard unit root tests (see Table ref:unitroot in appendix ref:appen:A) as well as textcite:johansen_estimation_1991 procedure to assess whether houses own-rate of interest and residential investment growth rate share a common long-run trend (see Table ref:Johansen in appendix ref:appen:A).
At a 5% significance level, we conclude that the series are cointegrated, which allows us to estimate a error correction model cite:enders_applied_2014.
In order to do so, we assume the following long-run relationship:

#+BEGIN_latex
\begin{equation}
\label{gihLR}
g_{I_{h_{t}}} = \phi_{0} + \phi_{1}\cdot own_{t}
\end{equation}
#+END_latex
where $\phi_0$ includes factors that we may consider as given (/e.g./ demographic factors, housing and credit policies, among other factors) while $\phi_1$ captures the price-interest rate sensibility of demand for new houses.
Next, we specify the short-run adjustment process of Equation ref:gihLR as follows:

#+begin_export latex
\begin{equation}
\label{matrix}
\begin{bmatrix}
\Delta own_{t}\\
\Delta g_{I_{h_{t}}}
\end{bmatrix} = \begin{bmatrix}\delta_{1}\\ \delta_{2}\end{bmatrix} + \begin{bmatrix}\alpha_{1}\\ \alpha_{2}\end{bmatrix} \begin{bmatrix}g_{I_{h_{t-1}}} - \phi_{0} - \phi_{1,2}\cdot own_{t-1}\\g_{I_{h_{t-1}}} - \phi_{0} - \phi_{1,1}\cdot own_{t-1}\end{bmatrix}^{\prime} + \sum^N_{i=1} \begin{bmatrix}\beta_{1,i} & \gamma_{1,i} \\\beta_{2,i} & \gamma_{2,i} \end{bmatrix} \begin{bmatrix}\Delta g_{I_{h_{t-i}}} \\\Delta own_{t-i}\end{bmatrix} + \varepsilon_{t}
\end{equation}
#+end_export
where $\delta$ indicate linear trend (level);
$\alpha$ are adjustment parameters;
$\beta$ and $\gamma$ are coefficients associated with lagged $g_{I_h}$ and $own$ respectively and; $\varepsilon$ are the residuals.


Considering the simple functional form of Equation ref:gihLR and the adjustment process of Equation ref:matrix we present the expected results in Table ref:resultados_esperados.
Once we report a cointegration relation between houses own-rate of interest and residential investment rate of growth, we expect that the residuals are stationary (hypothesis 1).
We also expect that residential investment growth rate has a positive long-run trend not related to price effects (hypothesis 5) while houses own-rate of interest has a negative effect as discussed before (hypothesis 4).
If  hypotheses 1, 4 and 5 are valid, houses own-rate of interest and residential investment rate of growth share a common long-run trend.
As discussed in subsection ref:sec:own, lagged houses own-rate of interest coefficients in residential investment equation ($\gamma_{2,2}$) should be negative and statistically significant (hypothesis 6).


\input{./tabs/hypothesis.tex}



Other relevant question is about economic meaning of Granger causality displayed in Table ref:resultados_esperados (hypothesis 2 and 3).
We expect that residential investment rate of growth does not affect  houses own-rate of interest.
The explanation is that house prices and mortgage rate of interest are defined to the whole housing market.
In this market the newly constructed houses are only a small share of total stock.
In this sense, we expect supply and demand on the stock of housing to affect its price and, as consequence,  the decisions to acquire and produce new houses.
But we do predict the reverse causality (hypothesis 7).
In econometric terms, we expect that $own$ is weakly exogenous compared to $g_{I_{h}}$.

For the purpose of determining the order of the model, we use four infomation criteria.
One (BIC) indicates no lag, the other three (AIC, FPE and HQIC) indicate four lags (see Table ref:criterios in appendix ref:appen:A).
# Despite its parsimony, we argue that the first lag has no empirical support.

In addition to the information criteria, we also have economic arguments in favor of usings lags.
What is relevant for someone acquiring a new house with intent to sale with profit is its future price in relation to the buying price, i.e., the future, instead of current, rate of inflation.
Nevertheless, data series of expected house inflation do not exist and, as consequence, it is not possible to build a series of expected house own-rate of interest.
So, in the absence of this series, lags of this variable are used as a proxy for the expected one.
This procedure is similar to textcite:keynes_general_1937  "practical theory of the future" in which decision-making process for buying a new asset (in this case, houses) depends on expectations/conventions based on past observations.
In this scenario, only persistent changes in house own-rate of interest will influence residential investment rate of growth.

Moreover, the construction of new houses takes time. According to the US Survey of Construction cite:SoC_2020, the average construction time (from approval to completion from 1999 to 2019) for a family unity for sale is approximately seven months[fn::Besides our estimation starts in 1992, we use 1999 in this case due to data availability.].
Both houses construction time by contract or by the owner, on the other side, takes approximately 8-12 months to conclude.
This provides more objective evidence for the relevance to residential investment of persistent change in own-rate of interest and for the use of lags in our model – more specifically, four lags.

Considering this theoretical and econometric discussion of model order specification, we estimate VEC with four lags  (see Table ref:Estimacao).
This lag order generates homoscedastic residuals without serial auto-correlation (see Table ref:testes_resduos in Appendix ref:appen:A).
We also report that our estimation is robust and not sensible to the lag order specification (see Table ref:tab:robust Appendix ref:appen:A for robustness check).
On the following subsection, we analyze the results and compare with the theoretical expected ones presented in Table ref:resultados_esperados.


** Estimation results
#+LATEX: \label{sec:results}

According to parameters presented in Table ref:Estimacao, we find statistically significant co-integration  coefficients for both equations. 
Therefore, both variables share a long-run trend (validating hypotheses 1 and 4).
The short-term relationship between $own$ and $g_{Ih}$ ($\beta_{1, is}$ coefficients) are not statistically significant at 5%.
In addition, coefficients $\gamma_{2,s}$ are negative and statistically significant at 5%, supporting hypothesis 6.
We also find statistically significant coefficients related to demand for houses for non-speculative reasons ($\phi_0$), validating proposition 5.
On the other hand, the error correction parameter is statistically significant only for the residential investment growth rate equation.
In this sense, $own$ is weakly exogenous compared to $g_{I_h}$ while houses own-rate of interest Granger-causes $g_{I_h}$, supporting the hypothesis (2) and (3).
Since the forth lag of houses own-rate of interest is the only statiscally significantly one at 5% level, we also support hypothesis 7.
In conclusion, our estimation results are in line with the expected ones and can be summarized as follows: houses own-rate of interest determines --- but is not determined by --- residential investment growth rate and these variables present a long-term relationship.

#+begin_export latex :exports none
\begin{figure}
	\centering
	\caption{Inspection of estimation residuals}
	\label{residuos}
	\includegraphics[width=.9\textwidth]{./figs/Residuals_4VECM.png}
	\caption*{\textbf{Source:} Authors' elaboration}
\end{figure}
#+end_export

Next, we analyze the orthogonilized impulse response function (OIRF, see Figure ref:irf).
In order to do so, we employ the Cholesky decomposition procedure by assuming that houses own-rate of interest is more "exogenous" than residential investment growth rate.
We report a decreasing effect of a $g_{I_h}$ shock on itself over time while a shock of own-rate of interest on itself has a non-explosive permanent effect.
On the other hand, an increase in $g_{I_h}$ has a null effect over $own$.
The most relevant result reported in Figure ref:irf is the considerable and lasting negative effect due to an increase in houses own-rate of interest over $g_{I_h}$.

#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Orthogonalized Impulse Response Function}
	\label{irf}
	\includegraphics[height=.4\textheight]{./figs/Impulse_VECMOrth_grey.png}
	\caption*{\textbf{Source:} Authors' elaboration}
\end{figure}
#+end_export

Figure ref:fevd display the forecast error variance decomposition (FEVD).
We report that houses own-rate of interest describes $g_{Ih}$ --- while the reverse is not valid --- after the first quarter.
In addition, we find that such contribution is greater than 50% beyond the third quarter (dashed line in Figure ref:fevd).
Therefore, houses own-rate of interest is explained mainly by itself and explains $g_{I_h}$ considerably.

#+begin_export latex
\begin{figure}[H]
	\centering
	\caption{Forecast error variance decomposition (FEVD)}
	\label{fevd}
	\includegraphics[width=.9\textwidth]{./figs/FEVD_VECMpython_TxPropria.png}
	\caption*{\textbf{Source:} Authors' elaboration}
\end{figure}
#+end_export


# Finally,  we contrast our findings with those discussed in Section ref:sec:empirical_review.
# At this stage, would be more adequate to restrict the comparison with the paper that estimates residential investment determinants as a function of some real mortgage interest rate after the institutional changes of the 90's.
# However, with this criteria, none of the revised papers would be elected.
# In this sense, we will reassess the discussion of the statistical significance between nominal and real mortgage interest rate.
# For the US case, textcite:fair_macroeconometric_2018 concludes that the nominal mortgage rate is more adequate since inflation variables "picks up" not included ones (such as expectations).
# We report opposites results since houses own-rate of interest are statistically significant and this is the case for a broad timespan (see Table ref:tab:robust in Appendix ref:appen:A).
# Thus, deflating mortgage interest rate by the relevant price index leads to different results.


In summary, our estimation reports that houses own-rate of interest has a prominent role in explaining residential investment growth rate movements.
It is worth noting that despite the amplitude of VEC order, our model is parsimonious considering the number of variables considered (see Table ref:tab:robust Appendix ref:appen:A).
Thus, we conclude that our estimation depicts the determinants of residential investment growth rate satisfactorily given its parsimony.
On the following section we present some concluding remarks.

